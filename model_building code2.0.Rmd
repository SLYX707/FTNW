---
title: "re-re"
output: html_document
---


```{r}
m6Ads <- readRDS(file.choose())
```


```{r}
library(SummarizedExperiment)
m6Ads <- readRDS("m6Ads_multi.rds")
#Data structure
dim(m6Ads) #1624625 DRACH sites on exons / 40 samples
#Sample information
colData(m6Ads)
#GRanges of sites/rows
rowRanges(m6Ads)
#Positive for each samples/columns
assay(m6Ads)
#iRNA-endoded sequence features
metadata(m6Ads)[["iRNA"]]
#Whistle used genome features
metadata(m6Ads)[["Whistle"]]
#Regulator features
metadata(m6Ads)[["Regulators"]] 
```


#Matrix
```{r}
Model_matrix_onehot <- metadata(m6Ads)[["OneHot"]]  # for logo
Model_matrix_irna <- metadata(m6Ads)[["iRNA"]]
Model_matrix_whistle <- metadata(m6Ads)[["WHISTLE_genomic"]]
Model_matrix_regulators <- metadata(m6Ads)[["Regulators"]]
Model_matrix_irna_whistle <- cbind(Model_matrix_irna, Model_matrix_whistle)
Model_matrix_irna_regulators <- cbind(Model_matrix_irna, Model_matrix_regulators)
Model_matrix_all <- cbind(Model_matrix_irna, Model_matrix_whistle,Model_matrix_regulators)
Model_matrix_logo1 <- cbind(Model_matrix_onehot, Model_matrix_whistle,Model_matrix_regulators) #for logo1
Model_matrix_logo2 <- Model_matrix_onehot #for logo2

Model_matrix_irna$Y <- rowSums(assay(m6Ads))
Model_matrix_irna_whistle$Y <- rowSums(assay(m6Ads))
Model_matrix_irna_regulators$Y <- rowSums(assay(m6Ads))
Model_matrix_all$Y <- rowSums(assay(m6Ads))
Model_matrix_logo1$Y <- rowSums(assay(m6Ads)) #for logo1
Model_matrix_logo2$Y <- rowSums(assay(m6Ads))# for logo2

#for the original Y,for table2(possion regression)
Model_or_matrix_irna <- Model_matrix_irna
Model_or_matrix_irna_whistle <- Model_matrix_irna_whistle
Model_or_matrix_irna_regulators <- Model_matrix_irna_regulators
Model_or_matrix_all <- Model_matrix_all
Model_or_matrix_logo2 <- Model_matrix_logo2

#no0 subset,for table4
Model_matrix_irna_no0 <- subset(Model_matrix_irna,Model_matrix_irna$Y > 0)
Model_matrix_irna_whistle_no0 <- subset(Model_matrix_irna_whistle,Model_matrix_irna_whistle$Y > 0)
Model_matrix_irna_regulators_no0 <- subset(Model_matrix_irna_regulators,Model_matrix_irna_regulators$Y > 0)
Model_matrix_all_no0 <- subset(Model_matrix_all,Model_matrix_all$Y > 0)

#for binary,for table1(classification)
Model_matrix_irna$Y[which(Model_matrix_irna$Y>0)] <- 1
Model_matrix_irna_whistle$Y[which(Model_matrix_irna_whistle$Y>0)] <- 1
Model_matrix_irna_regulators$Y[which(Model_matrix_irna_regulators$Y>0)] <- 1
Model_matrix_all$Y[which(Model_matrix_all$Y>0)] <- 1
Model_matrix_logo2$Y[which(Model_matrix_logo2$Y>0)] <- 1 #

Model_matrix_irna$Y <- as.factor(Model_matrix_irna$Y)
Model_matrix_irna_whistle$Y <- as.factor(Model_matrix_irna_whistle$Y)
Model_matrix_irna_regulators$Y <- as.factor(Model_matrix_irna_regulators$Y)
Model_matrix_all$Y <- as.factor(Model_matrix_all$Y)
Model_matrix_logo2$Y <- as.factor(Model_matrix_logo2$Y)#


#predictor
predictors_irna <- setdiff(colnames(Model_matrix_irna), "Y")
predictors_irna_whistle <- setdiff(colnames(Model_matrix_irna_whistle), "Y")
predictors_irna_regulators <- setdiff(colnames(Model_matrix_irna_regulators), "Y")
predictors_all <- setdiff(colnames(Model_matrix_all), "Y")
predictors_logo1 <- setdiff(colnames(Model_matrix_logo1), "Y") # for logo1
predictors_logo2 <- setdiff(colnames(Model_matrix_logo2), "Y") # for logo2
```

```{r}
#cla- whole(put the original count)
Model_matrix_irna$Yor <-Model_or_matrix_irna$Y
Model_matrix_irna_whistle$Yor <- Model_or_matrix_irna_whistle$Y
Model_matrix_irna_regulators$Yor <- Model_or_matrix_irna_regulators$Y
Model_matrix_all$Yor <- Model_or_matrix_all$Y
Model_matrix_logo2$Yor <- Model_or_matrix_logo2$Y
```

```{r}
library(h2o)
h2o.init()
```
#logo1
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_logo1),5)

data <- Model_matrix_logo1
pred_reg_glm_logo1 <- data.frame()
importance_reg_glm_logo1<-data.frame()


  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
      M_reg_glm_logo1 <- h2o.glm(x = predictors_logo1, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  family ="poisson",
                                                  seed = 1234)
                                     
    
    prediction <- h2o.predict(object = M_reg_glm_logo1, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_glm_logo1 <- rbind(pred_reg_glm_logo1,temp)
    
    #feature importance
    
    if(i==1){
      importance_reg_glm_logo1 <- h2o.varimp(M_reg_glm_logo1)[c("variable","percentage")]
      names(importance_reg_glm_logo1)[names(importance_reg_glm_logo1) == "percentage"] <- "percentage1"
            }else{
      importance_reg_glm_logo1 <- merge(x=importance_reg_glm_logo1,y=h2o.varimp(M_reg_glm_logo1)[c("variable","percentage")],by="variable")
      names(importance_reg_glm_logo1)[names(importance_reg_glm_logo1) == "percentage"] <- paste0("percentage",i)
            }
    
    #save model 
    setwd("~/Model")
    saveRDS(M_reg_glm_logo1,paste0("M_reg_glm_logo1_",i,".rds"))
  }

    (mse <- mean((as.vector(pred_reg_glm_logo1$Y)-as.vector(pred_reg_glm_logo1$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_glm_logo1$Y), as.vector(pred_reg_glm_logo1$predict)))))
```
#logo2
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_logo2),5)

data <- Model_matrix_logo2
pred_reg_glm_logo2 <- data.frame()
importance_reg_glm_logo2<-data.frame()


  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
      M_reg_glm_logo2 <- h2o.glm(x = predictors_logo2, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  family ="poisson",
                                                  seed = 1234)
                                     
    
    prediction <- h2o.predict(object = M_reg_glm_logo2, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_glm_logo2 <- rbind(pred_reg_glm_logo2,temp)
    
    #feature importance
    
    if(i==1){
      importance_reg_glm_logo2 <- h2o.varimp(M_reg_glm_logo2)[c("variable","percentage")]
      names(importance_reg_glm_logo2)[names(importance_reg_glm_logo2) == "percentage"] <- "percentage1"
            }else{
      importance_reg_glm_logo2 <- merge(x=importance_reg_glm_logo2,y=h2o.varimp(M_reg_glm_logo2)[c("variable","percentage")],by="variable")
      names(importance_reg_glm_logo2)[names(importance_reg_glm_logo2) == "percentage"] <- paste0("percentage",i)
            }
    
    #save model 
    setwd("~/Model")
    saveRDS(M_reg_glm_logo2,paste0("M_reg_glm_logo2_",i,".rds"))
  }

    (mse <- mean((as.vector(pred_reg_glm_logo2$Y)-as.vector(pred_reg_glm_logo2$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_glm_logo2$Y), as.vector(pred_reg_glm_logo2$predict)))))
```
#cla-glm-irna1
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_irna),5) #seperate the data set into five equal parts

# preperation
data <- Model_matrix_irna    # inport the data frame (all the features with Y(here is 0 or 1)and Yor(the count))
pred_cla_glm_irna <- data.frame()   # this line is for tabel 3,  
aba_cla_glm_irna <- data.frame()
prediciton <-data.frame()
importance_cla_glm_irna<-data.frame()
 
#5-fold
  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
    # Store corresponding count(authenticated)
    aba_cla_glm_irna <- rbind(aba_cla_glm_irna,subset(as.data.frame(test),select =Yor))   # It have Yor(the count) because I added, let is compare with the 40*p1. I also checked that site sequence is matched with the predict.
      # model
      M_cla_glm_irna<- h2o.glm(x = predictors_irna, y = "Y",     # x include the colum name (not include the "Y" or "Yor")
                                                  training_frame = as.h2o(train),   # each time input 1/5 of the data frame
                                                  seed = 123)
                                     
    # prediction--generate p1
    prediction <- h2o.predict(object = M_cla_glm_irna, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))  # combine the prediction(p1) with the original info. Final include(Y,predict,p0.p1)
    pred_cla_glm_irna <- rbind(pred_cla_glm_irna,temp)  #each add 1/5 predict
    
    # feature importance
    if(i==1){       # combine the percenetage of importance each round and get the mean.
      importance_cla_glm_irna <- h2o.varimp(M_cla_glm_irna)[c("variable","percentage")]
      names(importance_cla_glm_irna)[names(importance_cla_glm_irna) == "percentage"] <- "percentage1"
            }else{
      importance_cla_glm_irna <- merge(x=importance_cla_glm_irna,y=h2o.varimp(M_cla_glm_irna)[c("variable","percentage")],by="variable")
      names(importance_cla_glm_irna)[names(importance_cla_glm_irna) == "percentage"] <- paste0("percentage",i)
                  }
    # save model
    setwd("~/Model")
    saveRDS(M_cla_glm_irna,paste0("M_cla_glm_irna_",i,".rds"))
  }

# for table1--auc mcc
library(ROCR)
pred <- prediction(as.numeric(pred_cla_glm_irna$p1), as.numeric(pred_cla_glm_irna$Y))   # The prediction funciton of ROCR can get the F1 for us(actually the h2o can also caulculate the L1 but our 5 corss validation is caululated Manually)
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)

# for table3(calculate the "calssificaiton model's MSE and cross entropy" compare with Poisson regression model)
print("-------------------------------table3")
prediciton_cla_glm_irna3<-data.frame()
prediciton_cla_glm_irna3<- cbind(as.data.frame(pred_cla_glm_irna$p1),as.data.frame(aba_cla_glm_irna$Yor))
names(prediciton_cla_glm_irna3)[names(prediciton_cla_glm_irna3) == 'aba_cla_glm_irna$Yor'] <- 'Yor'
names(prediciton_cla_glm_irna3)[names(prediciton_cla_glm_irna3) == 'pred_cla_glm_irna$p1'] <- 'p1'

(mse <- mean((as.vector(as.numeric(prediciton_cla_glm_irna3$Yor))-as.vector(40*prediciton_cla_glm_irna3$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_glm_irna3$Yor)), as.vector(40*prediciton_cla_glm_irna3$p1)))))

# plot
importance_cla_glm_irna$mean <- apply(importance_cla_glm_irna[,2:6], 1, mean)# get the relative importance previously
importance_cla_glm_irna$sd <- apply(importance_cla_glm_irna[,2:6], 1, sd)
library(ggplot2)
P_importance_cla_glm_irna <-importance_cla_glm_irna[c("variable","mean","sd")] 
P_importance_cla_glm_irna<- P_importance_cla_glm_irna[order(P_importance_cla_glm_irna$mean,decreasing=TRUE),][1:20,]

plot_cla_glm_irna <- ggplot(P_importance_cla_glm_irna[order(P_importance_cla_glm_irna$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="GLM  Model for Classification (iRNA)", x="Feature (iRNA)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5)) # the standard deviation is calculated based on data mean from 5 fold corss validation
```

```{r}
# table5 (for the count that is larger than 0, test for whether the classification model get well prediction while the count is larger than 1)
w<- which(prediciton_cla_glm_irna3$Yor==0)
prediciton_cla_glm_irna5 <- prediciton_cla_glm_irna3[-w,]

(mse <- mean((as.vector(as.numeric(prediciton_cla_glm_irna5$Yor))-as.vector(40*prediciton_cla_glm_irna5$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_glm_irna5$Yor)), as.vector(40*prediciton_cla_glm_irna5$p1)))))

```
```{r}
# table6
mean_ycount_on_training <- mean(Model_matrix_irna$Yor)
# pred_ycount <- pmax( round( (prob_1*40) - mean(prob_1*40) + mean(ycount_on_training)), 1)
prediciton_cla_glm_irna6 <- prediciton_cla_glm_irna5
prediciton_cla_glm_irna6$pred <- pmax( round( (prediciton_cla_glm_irna5$p1*40) - mean(prediciton_cla_glm_irna5$p1*40) + mean_ycount_on_training), 1)

(mse <- mean((as.vector(as.numeric(prediciton_cla_glm_irna6$Yor))-as.vector(prediciton_cla_glm_irna6$pred))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_glm_irna6$Yor)), as.vector(prediciton_cla_glm_irna6$pred)))))
```

#cla-dl-irna2
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_irna),5)  #seperate the data set into five equal parts

#preperation
data <- Model_matrix_irna  #inport the data frame (all the features with Y(here is 0 or 1)and Yor(the count))
pred_cla_dl_irna <- data.frame() #this  is for tabel 3,  
aba_cla_dl_irna <- data.frame()
prediciton <-data.frame()
importance_cla_dl_irna<-data.frame()

#5-fold
  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
    #Store corresponding count(authenticated)
    aba_cla_dl_irna <- rbind(aba_cla_dl_irna,subset(as.data.frame(test),select =Yor))#It have Yor(the count) because I added, let is compare with the 40*p1. I also checked that site sequence is matched with the predict.
    
    #model
     M_cla_dl_irna<- h2o.deeplearning(x = predictors_irna, y = "Y", # x include the colum name (not include the "Y" or "Yor")
                                                  training_frame = as.h2o(train),# each time input 1/5 of the data frame
                                                  hidden = c(1),
                                                  seed = 1234)
    #prediction--generate p1
    prediction <- h2o.predict(object = M_cla_dl_irna, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))#combine the prediction(p1) with the original info. Final include(Y,predict,p0.p1)
    pred_cla_dl_irna <- rbind(pred_cla_dl_irna,temp)  #each add 1/5 predict
    
    #feature importance
    if(i==1){#combine the percenetage of importance each round and get the mean.
      importance_cla_dl_irna <- h2o.varimp(M_cla_dl_irna)[c("variable","percentage")]
      names(importance_cla_dl_irna)[names(importance_cla_dl_irna) == "percentage"] <- "percentage1"
            }else{
      importance_cla_dl_irna <- merge(x=importance_cla_dl_irna,y=h2o.varimp(M_cla_dl_irna)[c("variable","percentage")],by="variable")
      names(importance_cla_dl_irna)[names(importance_cla_dl_irna) == "percentage"] <- paste0("percentage",i)
                  }
    #save model
    setwd("~/Model")
    saveRDS(M_cla_dl_irna,paste0("M_cla_dl_irna_",i,".rds"))
  }

#for table1--auc mcc
library(ROCR)
pred <- prediction(as.numeric(pred_cla_dl_irna$p1), as.numeric(pred_cla_dl_irna$Y))# The prediction funciton of ROCR can get the F1 for us(actually the h2o can also caulculate the L1 but our 5 corss validation is caululated Manually)
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)

#for table3(calculate the "calssificaiton model's MSE and cross entropy" compare with Poisson regression model)
print("-------------------------------table3")
prediciton_cla_dl_irna3<-data.frame()
prediciton_cla_dl_irna3<- cbind(as.data.frame(pred_cla_dl_irna$p1),as.data.frame(aba_cla_dl_irna$Yor))
names(prediciton_cla_dl_irna3)[names(prediciton_cla_dl_irna3) == 'aba_cla_dl_irna$Yor'] <- 'Yor'
names(prediciton_cla_dl_irna3)[names(prediciton_cla_dl_irna3) == 'pred_cla_dl_irna$p1'] <- 'p1'

(mse <- mean((as.vector(as.numeric(prediciton_cla_dl_irna3$Yor))-as.vector(40*prediciton_cla_dl_irna3$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_dl_irna3$Yor)), as.vector(40*prediciton_cla_dl_irna3$p1)))))

#plot
importance_cla_dl_irna$mean <- apply(importance_cla_dl_irna[,2:6], 1, mean)# get the relative importance previously
importance_cla_dl_irna$sd <- apply(importance_cla_dl_irna[,2:6], 1, sd)
library(ggplot2)
P_importance_cla_dl_irna <-importance_cla_dl_irna[c("variable","mean","sd")] 
P_importance_cla_dl_irna<- P_importance_cla_dl_irna[order(P_importance_cla_dl_irna$mean,decreasing=TRUE),][1:20,]

plot_cla_dl_irna <- ggplot(P_importance_cla_dl_irna[order(P_importance_cla_dl_irna$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="MLP  Model for Classification (iRNA)", x="Feature (iRNA)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))# the standard deviation is calculated based on data mean from 5 fold corss validation
```
```{r}
#table5(for the count that is larger than 0, test for whether the classification model get well prediction while the count is larger than 1)
w<- which(prediciton_cla_dl_irna3$Yor==0)
prediciton_cla_dl_irna5 <- prediciton_cla_dl_irna3[-w,]

(mse <- mean((as.vector(as.numeric(prediciton_cla_dl_irna5$Yor))-as.vector(40*prediciton_cla_dl_irna5$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_dl_irna5$Yor)), as.vector(40*prediciton_cla_dl_irna5$p1)))))

```
```{r}
#table6
prediciton_cla_dl_irna6 <- prediciton_cla_dl_irna5
prediciton_cla_dl_irna6$pred <- pmax( round( (prediciton_cla_dl_irna5$p1*40) - mean(prediciton_cla_dl_irna5$p1*40) + mean_ycount_on_training), 1)

(mse <- mean((as.vector(as.numeric(prediciton_cla_dl_irna6$Yor))-as.vector(prediciton_cla_dl_irna6$pred))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_dl_irna6$Yor)), as.vector(prediciton_cla_dl_irna6$pred)))))
```

#cla-xgboost-irna3
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_irna),5)

#preperation
data <- Model_matrix_irna
pred_cla_xgboost_irna <- data.frame()   
aba_cla_xgboost_irna <- data.frame()
prediciton <-data.frame()
importance_cla_xgboost_irna<-data.frame()

#5-fold
  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
    #Store corresponding count(authenticated)
    aba_cla_xgboost_irna <- rbind(aba_cla_xgboost_irna,subset(as.data.frame(test),select =Yor))
    
    #model
      M_cla_xgboost_irna <- h2o.xgboost(x = predictors_irna, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  learn_rate = 0.05,
                                                  gamma = 5,
                                                  max_depth = 5,
                                                  reg_alpha = 10,
                                                  reg_lambda = 10,
                                                  colsample_bytree = 0.3,
                                                  booster = "gbtree", 
                                                  normalize_type = "tree",
                                                  seed = 1234)
    #prediction--generate p1
    prediction <- h2o.predict(object = M_cla_xgboost_irna, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_cla_xgboost_irna <- rbind(pred_cla_xgboost_irna,temp)  
    #feature importance
    if(i==1){
      importance_cla_xgboost_irna <- h2o.varimp(M_cla_xgboost_irna)[c("variable","percentage")]
      names(importance_cla_xgboost_irna)[names(importance_cla_xgboost_irna) == "percentage"] <- "percentage1"
            }else{
      importance_cla_xgboost_irna <- merge(x=importance_cla_xgboost_irna,y=h2o.varimp(M_cla_xgboost_irna)[c("variable","percentage")],by="variable")
      names(importance_cla_xgboost_irna)[names(importance_cla_xgboost_irna) == "percentage"] <- paste0("percentage",i)
                  }
    #save model
    setwd("~/Model")
    saveRDS(M_cla_xgboost_irna,paste0("M_cla_xgboost_irna_",i,".rds"))
  }

#for table1--auc mcc
library(ROCR)
pred <- prediction(as.numeric(pred_cla_xgboost_irna$p1), as.numeric(pred_cla_xgboost_irna$Y))
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)

#for table3
print("-------------------------------table3")
prediciton_cla_xgboost_irna3<-data.frame()
prediciton_cla_xgboost_irna3<- cbind(as.data.frame(pred_cla_xgboost_irna$p1),as.data.frame(aba_cla_xgboost_irna$Yor))
names(prediciton_cla_xgboost_irna3)[names(prediciton_cla_xgboost_irna3) == 'aba_cla_xgboost_irna$Yor'] <- 'Yor'
names(prediciton_cla_xgboost_irna3)[names(prediciton_cla_xgboost_irna3) == 'pred_cla_xgboost_irna$p1'] <- 'p1'

(mse <- mean((as.vector(as.numeric(prediciton_cla_xgboost_irna3$Yor))-as.vector(40*prediciton_cla_xgboost_irna3$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_xgboost_irna3$Yor)), as.vector(40*prediciton_cla_xgboost_irna3$p1)))))

#plot
importance_cla_xgboost_irna$mean <- apply(importance_cla_xgboost_irna[,2:6], 1, mean)
importance_cla_xgboost_irna$sd <- apply(importance_cla_xgboost_irna[,2:6], 1, sd)
library(ggplot2)
P_importance_cla_xgboost_irna <-importance_cla_xgboost_irna[c("variable","mean","sd")] 
P_importance_cla_xgboost_irna<- P_importance_cla_xgboost_irna[order(P_importance_cla_xgboost_irna$mean,decreasing=TRUE),][1:20,]

plot_cla_xgboost_irna <- ggplot(P_importance_cla_xgboost_irna[order(P_importance_cla_xgboost_irna$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="XGBoost Model for Classification (iRNA)", x="Feature (iRNA)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))

```
```{r}
#table5
w<- which(prediciton_cla_xgboost_irna3$Yor==0)
prediciton_cla_xgboost_irna5 <- prediciton_cla_xgboost_irna3[-w,]

(mse <- mean((as.vector(as.numeric(prediciton_cla_xgboost_irna5$Yor))-as.vector(40*prediciton_cla_xgboost_irna5$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_xgboost_irna5$Yor)), as.vector(40*prediciton_cla_xgboost_irna5$p1)))))

```
```{r}
#table6
prediciton_cla_xgboost_irna6 <- prediciton_cla_xgboost_irna5
prediciton_cla_xgboost_irna6$pred <- pmax( round( (prediciton_cla_xgboost_irna5$p1*40) - mean(prediciton_cla_xgboost_irna5$p1*40) + mean_ycount_on_training), 1)

(mse <- mean((as.vector(as.numeric(prediciton_cla_xgboost_irna6$Yor))-as.vector(prediciton_cla_xgboost_irna6$pred))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_xgboost_irna6$Yor)), as.vector(prediciton_cla_xgboost_irna6$pred)))))
```

#cla_rf_irna4
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_irna),5)

#preperation
data <- Model_matrix_irna
pred_cla_rf_irna <- data.frame()   
aba_cla_rf_irna <- data.frame()
prediciton <-data.frame()
importance_cla_rf_irna<-data.frame()

#5-fold
  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
    #Store corresponding count(authenticated)
    aba_cla_rf_irna <- rbind(aba_cla_rf_irna,subset(as.data.frame(test),select =Yor))
    
    #model
    M_cla_rf_irna <- h2o.randomForest(
                   x = predictors_irna,
                   y = "Y",
                   training_frame= as.h2o(train),
                   ntrees = 20,
                   max_depth = 10,
                    seed = 1234,
                   min_rows = 1
 )

    #prediction--generate p1
    prediction <- h2o.predict(object = M_cla_rf_irna, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_cla_rf_irna <- rbind(pred_cla_rf_irna,temp)  
    #feature importance
    if(i==1){
      importance_cla_rf_irna <- h2o.varimp(M_cla_rf_irna)[c("variable","percentage")]
      names(importance_cla_rf_irna)[names(importance_cla_rf_irna) == "percentage"] <- "percentage1"
            }else{
      importance_cla_rf_irna <- merge(x=importance_cla_rf_irna,y=h2o.varimp(M_cla_rf_irna)[c("variable","percentage")],by="variable")
      names(importance_cla_rf_irna)[names(importance_cla_rf_irna) == "percentage"] <- paste0("percentage",i)
                  }
    #save model
    setwd("~/Model")
    saveRDS(M_cla_rf_irna,paste0("M_cla_rf_irna_",i,".rds"))
  }

#for table1--auc mcc
library(ROCR)
pred <- prediction(as.numeric(pred_cla_rf_irna$p1), as.numeric(pred_cla_rf_irna$Y))
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)

#for table3
print("-------------------------------table3")
prediciton_cla_rf_irna3<-data.frame()
prediciton_cla_rf_irna3<- cbind(as.data.frame(pred_cla_rf_irna$p1),as.data.frame(aba_cla_rf_irna$Yor))
names(prediciton_cla_rf_irna3)[names(prediciton_cla_rf_irna3) == 'aba_cla_rf_irna$Yor'] <- 'Yor'
names(prediciton_cla_rf_irna3)[names(prediciton_cla_rf_irna3) == 'pred_cla_rf_irna$p1'] <- 'p1'

(mse <- mean((as.vector(as.numeric(prediciton_cla_rf_irna3$Yor))-as.vector(40*prediciton_cla_rf_irna3$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_rf_irna3$Yor)), as.vector(40*prediciton_cla_rf_irna3$p1)))))

#plot
importance_cla_rf_irna$mean <- apply(importance_cla_rf_irna[,2:6], 1, mean)
importance_cla_rf_irna$sd <- apply(importance_cla_rf_irna[,2:6], 1, sd)
library(ggplot2)
P_importance_cla_rf_irna <-importance_cla_rf_irna[c("variable","mean","sd")] 
P_importance_cla_rf_irna<- P_importance_cla_rf_irna[order(P_importance_cla_rf_irna$mean,decreasing=TRUE),][1:20,]

plot_cla_rf_irna <- ggplot(P_importance_cla_rf_irna[order(P_importance_cla_rf_irna$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="RF Model for Classification (iRNA)", x="Feature (iRNA)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```
```{r}
#table5
w<- which(prediciton_cla_rf_irna3$Yor==0)
prediciton_cla_rf_irna5<- prediciton_cla_rf_irna3[-w,]

(mse <- mean((as.vector(as.numeric(prediciton_cla_rf_irna5$Yor))-as.vector(40*prediciton_cla_rf_irna5$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_rf_irna5$Yor)), as.vector(40*prediciton_cla_rf_irna5$p1)))))

```
```{r}
#table6
prediciton_cla_rf_irna6 <- prediciton_cla_rf_irna5
prediciton_cla_rf_irna6$pred <- pmax( round( (prediciton_cla_rf_irna5$p1*40) - mean(prediciton_cla_rf_irna5$p1*40) + mean_ycount_on_training), 1)

(mse <- mean((as.vector(as.numeric(prediciton_cla_rf_irna6$Yor))-as.vector(prediciton_cla_rf_irna6$pred))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_rf_irna6$Yor)), as.vector(prediciton_cla_rf_irna6$pred)))))
```


#cla_glm_irna_whistle5
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_irna_whistle),5)

#preperation
data <- Model_matrix_irna_whistle
pred_cla_glm_irna_whistle <- data.frame()   
aba_cla_glm_irna_whistle <- data.frame()
prediciton <-data.frame()
importance_cla_glm_irna_whistle<-data.frame()

#5-fold
  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
    #Store corresponding count(authenticated)
    aba_cla_glm_irna_whistle <- rbind(aba_cla_glm_irna_whistle,subset(as.data.frame(test),select =Yor))
      #model
      M_cla_glm_irna_whistle<- h2o.glm(x = predictors_irna_whistle, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  seed = 123)
                                     
    #prediction--generate p1
    prediction <- h2o.predict(object = M_cla_glm_irna_whistle, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_cla_glm_irna_whistle <- rbind(pred_cla_glm_irna_whistle,temp)  
    #feature importance
    if(i==1){
      importance_cla_glm_irna_whistle <- h2o.varimp(M_cla_glm_irna_whistle)[c("variable","percentage")]
      names(importance_cla_glm_irna_whistle)[names(importance_cla_glm_irna_whistle) == "percentage"] <- "percentage1"
            }else{
      importance_cla_glm_irna_whistle <- merge(x=importance_cla_glm_irna_whistle,y=h2o.varimp(M_cla_glm_irna_whistle)[c("variable","percentage")],by="variable")
      names(importance_cla_glm_irna_whistle)[names(importance_cla_glm_irna_whistle) == "percentage"] <- paste0("percentage",i)
                  }
    #save model
    setwd("~/Model")
    saveRDS(M_cla_glm_irna_whistle,paste0("M_cla_glm_irna_whistle_",i,".rds"))
  }

#for table1--auc mcc
library(ROCR)
pred <- prediction(as.numeric(pred_cla_glm_irna_whistle$p1), as.numeric(pred_cla_glm_irna_whistle$Y))
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)

#for table3
print("-------------------------------table3")
prediciton_cla_glm_irna_whistle3<-data.frame()
prediciton_cla_glm_irna_whistle3<- cbind(as.data.frame(pred_cla_glm_irna_whistle$p1),as.data.frame(aba_cla_glm_irna_whistle$Yor))
names(prediciton_cla_glm_irna_whistle3)[names(prediciton_cla_glm_irna_whistle3) == 'aba_cla_glm_irna_whistle$Yor'] <- 'Yor'
names(prediciton_cla_glm_irna_whistle3)[names(prediciton_cla_glm_irna_whistle3) == 'pred_cla_glm_irna_whistle$p1'] <- 'p1'

(mse <- mean((as.vector(as.numeric(prediciton_cla_glm_irna_whistle3$Yor))-as.vector(40*prediciton_cla_glm_irna_whistle3$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_glm_irna_whistle3$Yor)), as.vector(40*prediciton_cla_glm_irna_whistle3$p1)))))

#plot
importance_cla_glm_irna_whistle$mean <- apply(importance_cla_glm_irna_whistle[,2:6], 1, mean)
importance_cla_glm_irna_whistle$sd <- apply(importance_cla_glm_irna_whistle[,2:6], 1, sd)
library(ggplot2)
P_importance_cla_glm_irna_whistle <-importance_cla_glm_irna_whistle[c("variable","mean","sd")] 
P_importance_cla_glm_irna_whistle<- P_importance_cla_glm_irna_whistle[order(P_importance_cla_glm_irna_whistle$mean,decreasing=TRUE),][1:20,]

plot_cla_glm_irna_whistle <- ggplot(P_importance_cla_glm_irna_whistle[order(P_importance_cla_glm_irna_whistle$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="GLM  Model for Classification (iRNA & Genomic)", x="Feature (iRNA & Genomic)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```
```{r}
#table5
w<- which(prediciton_cla_glm_irna_whistle3$Yor==0)
prediciton_cla_glm_irna_whistle5<- prediciton_cla_glm_irna_whistle3[-w,]

(mse <- mean((as.vector(as.numeric(prediciton_cla_glm_irna_whistle5$Yor))-as.vector(40*prediciton_cla_glm_irna_whistle5$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_glm_irna_whistle5$Yor)), as.vector(40*prediciton_cla_glm_irna_whistle5$p1)))))

```
```{r}
#table6
prediciton_cla_glm_irna_whistle6 <- prediciton_cla_glm_irna_whistle5
prediciton_cla_glm_irna_whistle6$pred <- pmax( round( (prediciton_cla_glm_irna_whistle5$p1*40) - mean(prediciton_cla_glm_irna_whistle5$p1*40) + mean_ycount_on_training), 1)

(mse <- mean((as.vector(as.numeric(prediciton_cla_glm_irna_whistle6$Yor))-as.vector(prediciton_cla_glm_irna_whistle6$pred))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_glm_irna_whistle6$Yor)), as.vector(prediciton_cla_glm_irna_whistle6$pred)))))
```

#cla_dl_irna_whistle6
```{r}

 library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_irna_whistle),5)

#preperation
data <- Model_matrix_irna_whistle
pred_cla_dl_irna_whistle <- data.frame()   
aba_cla_dl_irna_whistle <- data.frame()
prediciton <-data.frame()
importance_cla_dl_irna_whistle<-data.frame()

#5-fold
  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
    #Store corresponding count(authenticated)
    aba_cla_dl_irna_whistle <- rbind(aba_cla_dl_irna_whistle,subset(as.data.frame(test),select =Yor))
      #model
      M_cla_dl_irna_whistle<- h2o.deeplearning(x = predictors_irna_whistle, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  hidden = c(1),
                                                  seed = 1234)
    #prediction--generate p1
    prediction <- h2o.predict(object = M_cla_dl_irna_whistle, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_cla_dl_irna_whistle <- rbind(pred_cla_dl_irna_whistle,temp)  
    #feature importance
    if(i==1){
      importance_cla_dl_irna_whistle <- h2o.varimp(M_cla_dl_irna_whistle)[c("variable","percentage")]
      names(importance_cla_dl_irna_whistle)[names(importance_cla_dl_irna_whistle) == "percentage"] <- "percentage1"
            }else{
      importance_cla_dl_irna_whistle <- merge(x=importance_cla_dl_irna_whistle,y=h2o.varimp(M_cla_dl_irna_whistle)[c("variable","percentage")],by="variable")
      names(importance_cla_dl_irna_whistle)[names(importance_cla_dl_irna_whistle) == "percentage"] <- paste0("percentage",i)
                  }
    #save model
    setwd("~/Model")
    saveRDS(M_cla_dl_irna_whistle,paste0("M_cla_dl_irna_whistle_",i,".rds"))
  }

#for table1--auc mcc
library(ROCR)
pred <- prediction(as.numeric(pred_cla_dl_irna_whistle$p1), as.numeric(pred_cla_dl_irna_whistle$Y))
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)

#for table3
print("-------------------------------table3")
prediciton_cla_dl_irna_whistle3<-data.frame()
prediciton_cla_dl_irna_whistle3<- cbind(as.data.frame(pred_cla_dl_irna_whistle$p1),as.data.frame(aba_cla_dl_irna_whistle$Yor))
names(prediciton_cla_dl_irna_whistle3)[names(prediciton_cla_dl_irna_whistle3) == 'aba_cla_dl_irna_whistle$Yor'] <- 'Yor'
names(prediciton_cla_dl_irna_whistle3)[names(prediciton_cla_dl_irna_whistle3) == 'pred_cla_dl_irna_whistle$p1'] <- 'p1'

(mse <- mean((as.vector(as.numeric(prediciton_cla_dl_irna_whistle3$Yor))-as.vector(40*prediciton_cla_dl_irna_whistle3$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_dl_irna_whistle3$Yor)), as.vector(40*prediciton_cla_dl_irna_whistle3$p1)))))

#plot
importance_cla_dl_irna_whistle$mean <- apply(importance_cla_dl_irna_whistle[,2:6], 1, mean)
importance_cla_dl_irna_whistle$sd <- apply(importance_cla_dl_irna_whistle[,2:6], 1, sd)
library(ggplot2)
P_importance_cla_dl_irna_whistle <-importance_cla_dl_irna_whistle[c("variable","mean","sd")] 
P_importance_cla_dl_irna_whistle<- P_importance_cla_dl_irna_whistle[order(P_importance_cla_dl_irna_whistle$mean,decreasing=TRUE),][1:20,]

plot_cla_dl_irna_whistle <- ggplot(P_importance_cla_dl_irna_whistle[order(P_importance_cla_dl_irna_whistle$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="MLP  Model for Classification (iRNA & Genomic)", x="Feature (iRNA & Genomic)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))                                    
    
```
```{r}
#table5
w<- which(prediciton_cla_dl_irna_whistle3$Yor==0)
prediciton_cla_dl_irna_whistle5<- prediciton_cla_dl_irna_whistle3[-w,]

(mse <- mean((as.vector(as.numeric(prediciton_cla_dl_irna_whistle5$Yor))-as.vector(40*prediciton_cla_dl_irna_whistle5$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_dl_irna_whistle5$Yor)), as.vector(40*prediciton_cla_dl_irna_whistle5$p1)))))

```
```{r}
#table6
prediciton_cla_dl_irna_whistle6 <- prediciton_cla_dl_irna_whistle5
prediciton_cla_dl_irna_whistle6$pred <- pmax( round( (prediciton_cla_dl_irna_whistle5$p1*40) - mean(prediciton_cla_dl_irna_whistle5$p1*40) + mean_ycount_on_training), 1)

(mse <- mean((as.vector(as.numeric(prediciton_cla_dl_irna_whistle6$Yor))-as.vector(prediciton_cla_dl_irna_whistle6$pred))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_dl_irna_whistle6$Yor)), as.vector(prediciton_cla_dl_irna_whistle6$pred)))))
```

#cla_xgboost_irna_whistle7
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_irna_whistle),5)

#preperation
data <- Model_matrix_irna_whistle
pred_cla_xgboost_irna_whistle <- data.frame()   
aba_cla_xgboost_irna_whistle <- data.frame()
prediciton <-data.frame()
importance_cla_xgboost_irna_whistle<-data.frame()

#5-fold
  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
    #Store corresponding count(authenticated)
    aba_cla_xgboost_irna_whistle <- rbind(aba_cla_xgboost_irna_whistle,subset(as.data.frame(test),select =Yor))
      #model
      M_cla_xgboost_irna_whistle <- h2o.xgboost(x = predictors_irna_whistle, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  learn_rate = 0.05,
                                                  gamma = 5,
                                                  max_depth = 5,
                                                  reg_alpha = 10,
                                                  reg_lambda = 10,
                                                  colsample_bytree = 0.3,
                                                  booster = "gbtree", 
                                                  normalize_type = "tree",
                                                  seed = 1234)
                                     
                                     
    #prediction--generate p1
    prediction <- h2o.predict(object = M_cla_xgboost_irna_whistle, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_cla_xgboost_irna_whistle <- rbind(pred_cla_xgboost_irna_whistle,temp)  
    #feature importance
    if(i==1){
      importance_cla_xgboost_irna_whistle <- h2o.varimp(M_cla_xgboost_irna_whistle)[c("variable","percentage")]
      names(importance_cla_xgboost_irna_whistle)[names(importance_cla_xgboost_irna_whistle) == "percentage"] <- "percentage1"
            }else{
      importance_cla_xgboost_irna_whistle <- merge(x=importance_cla_xgboost_irna_whistle,y=h2o.varimp(M_cla_xgboost_irna_whistle)[c("variable","percentage")],by="variable")
      names(importance_cla_xgboost_irna_whistle)[names(importance_cla_xgboost_irna_whistle) == "percentage"] <- paste0("percentage",i)
                  }
    #save model
    setwd("~/Model")
    saveRDS(M_cla_xgboost_irna_whistle,paste0("M_cla_xgboost_irna_whistle_",i,".rds"))
  }

#for table1--auc mcc
library(ROCR)
pred <- prediction(as.numeric(pred_cla_xgboost_irna_whistle$p1), as.numeric(pred_cla_xgboost_irna_whistle$Y))
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)

#for table3
print("-------------------------------table3")
prediciton_cla_xgboost_irna_whistle3<-data.frame()
prediciton_cla_xgboost_irna_whistle3<- cbind(as.data.frame(pred_cla_xgboost_irna_whistle$p1),as.data.frame(aba_cla_xgboost_irna_whistle$Yor))
names(prediciton_cla_xgboost_irna_whistle3)[names(prediciton_cla_xgboost_irna_whistle3) == 'aba_cla_xgboost_irna_whistle$Yor'] <- 'Yor'
names(prediciton_cla_xgboost_irna_whistle3)[names(prediciton_cla_xgboost_irna_whistle3) == 'pred_cla_xgboost_irna_whistle$p1'] <- 'p1'

(mse <- mean((as.vector(as.numeric(prediciton_cla_xgboost_irna_whistle3$Yor))-as.vector(40*prediciton_cla_xgboost_irna_whistle3$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_xgboost_irna_whistle3$Yor)), as.vector(40*prediciton_cla_xgboost_irna_whistle3$p1)))))

#plot
importance_cla_xgboost_irna_whistle$mean <- apply(importance_cla_xgboost_irna_whistle[,2:6], 1, mean)
importance_cla_xgboost_irna_whistle$sd <- apply(importance_cla_xgboost_irna_whistle[,2:6], 1, sd)
library(ggplot2)
P_importance_cla_xgboost_irna_whistle <-importance_cla_xgboost_irna_whistle[c("variable","mean","sd")] 
P_importance_cla_xgboost_irna_whistle<- P_importance_cla_xgboost_irna_whistle[order(P_importance_cla_xgboost_irna_whistle$mean,decreasing=TRUE),][1:20,]

plot_cla_xgboost_irna_whistle <- ggplot(P_importance_cla_xgboost_irna_whistle[order(P_importance_cla_xgboost_irna_whistle$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="XGBoost Model for Classification (iRNA & Genomic)", x="Feature (iRNA & Genomic)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```

```{r}
#table5
w<- which(prediciton_cla_xgboost_irna_whistle3$Yor==0)
prediciton_cla_xgboost_irna_whistle5<- prediciton_cla_xgboost_irna_whistle3[-w,]

(mse <- mean((as.vector(as.numeric(prediciton_cla_xgboost_irna_whistle5$Yor))-as.vector(40*prediciton_cla_xgboost_irna_whistle5$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_xgboost_irna_whistle5$Yor)), as.vector(40*prediciton_cla_xgboost_irna_whistle5$p1)))))

```
```{r}
#table6
prediciton_cla_xgboost_irna_whistle6 <- prediciton_cla_xgboost_irna_whistle5
prediciton_cla_xgboost_irna_whistle6$pred <- pmax( round( (prediciton_cla_xgboost_irna_whistle6$p1*40) - mean(prediciton_cla_xgboost_irna_whistle5$p1*40) + mean_ycount_on_training), 1)

(mse <- mean((as.vector(as.numeric(prediciton_cla_xgboost_irna_whistle6$Yor))-as.vector(prediciton_cla_xgboost_irna_whistle6$pred))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_xgboost_irna_whistle6$Yor)), as.vector(prediciton_cla_xgboost_irna_whistle6$pred)))))
```
#cla_rf_irna_whistle8
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_irna_whistle),5)

#preperation
data <- Model_matrix_irna_whistle
pred_cla_rf_irna_whistle <- data.frame()   
aba_cla_rf_irna_whistle <- data.frame()
prediciton <-data.frame()
importance_cla_rf_irna_whistle<-data.frame()

#5-fold
  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
    #Store corresponding count(authenticated)
    aba_cla_rf_irna_whistle <- rbind(aba_cla_rf_irna_whistle,subset(as.data.frame(test),select =Yor))
    
    #model
    M_cla_rf_irna_whistle <- h2o.randomForest(
                   x = predictors_irna_whistle,
                   y = "Y",
                   training_frame= as.h2o(train),
                   ntrees = 20,
                   max_depth = 10,
                    seed = 1234,
                   min_rows = 1
 )

    #prediction--generate p1
    prediction <- h2o.predict(object = M_cla_rf_irna_whistle, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_cla_rf_irna_whistle <- rbind(pred_cla_rf_irna_whistle,temp)  
    #feature importance
    if(i==1){
      importance_cla_rf_irna_whistle <- h2o.varimp(M_cla_rf_irna_whistle)[c("variable","percentage")]
      names(importance_cla_rf_irna_whistle)[names(importance_cla_rf_irna_whistle) == "percentage"] <- "percentage1"
            }else{
      importance_cla_rf_irna_whistle <- merge(x=importance_cla_rf_irna_whistle,y=h2o.varimp(M_cla_rf_irna_whistle)[c("variable","percentage")],by="variable")
      names(importance_cla_rf_irna_whistle)[names(importance_cla_rf_irna_whistle) == "percentage"] <- paste0("percentage",i)
                  }
    #save model
    setwd("~/Model")
    saveRDS(M_cla_rf_irna_whistle,paste0("M_cla_rf_irna_whistle_",i,".rds"))
  }

#for table1--auc mcc
library(ROCR)
pred <- prediction(as.numeric(pred_cla_rf_irna_whistle$p1), as.numeric(pred_cla_rf_irna_whistle$Y))
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)

#for table3
print("-------------------------------table3")
prediciton_cla_rf_irna_whistle3<-data.frame()
prediciton_cla_rf_irna_whistle3<- cbind(as.data.frame(pred_cla_rf_irna_whistle$p1),as.data.frame(aba_cla_rf_irna_whistle$Yor))
names(prediciton_cla_rf_irna_whistle3)[names(prediciton_cla_rf_irna_whistle3) == 'aba_cla_rf_irna_whistle$Yor'] <- 'Yor'
names(prediciton_cla_rf_irna_whistle3)[names(prediciton_cla_rf_irna_whistle3) == 'pred_cla_rf_irna_whistle$p1'] <- 'p1'

(mse <- mean((as.vector(as.numeric(prediciton_cla_rf_irna_whistle3$Yor))-as.vector(40*prediciton_cla_rf_irna_whistle3$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_rf_irna_whistle3$Yor)), as.vector(40*prediciton_cla_rf_irna_whistle3$p1)))))

#plot
importance_cla_rf_irna_whistle$mean <- apply(importance_cla_rf_irna_whistle[,2:6], 1, mean)
importance_cla_rf_irna_whistle$sd <- apply(importance_cla_rf_irna_whistle[,2:6], 1, sd)
library(ggplot2)
P_importance_cla_rf_irna_whistle <-importance_cla_rf_irna_whistle[c("variable","mean","sd")] 
P_importance_cla_rf_irna_whistle<- P_importance_cla_rf_irna_whistle[order(P_importance_cla_rf_irna_whistle$mean,decreasing=TRUE),][1:20,]

plot_cla_rf_irna_whistle <- ggplot(P_importance_cla_rf_irna_whistle[order(P_importance_cla_rf_irna_whistle$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="RF  Model for Classification
 (iRNA & Genomic)", x="Feature (iRNA & Genomic)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```

```{r}
#table5
w<- which(prediciton_cla_rf_irna_whistle3$Yor==0)
prediciton_cla_rf_irna_whistle5<- prediciton_cla_rf_irna_whistle3[-w,]

(mse <- mean((as.vector(as.numeric(prediciton_cla_rf_irna_whistle5$Yor))-as.vector(40*prediciton_cla_rf_irna_whistle5$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_rf_irna_whistle5$Yor)), as.vector(40*prediciton_cla_rf_irna_whistle5$p1)))))

```
```{r}
#table6
prediciton_cla_rf_irna_whistle6 <- prediciton_cla_rf_irna_whistle5
prediciton_cla_rf_irna_whistle6$pred <- pmax( round( (prediciton_cla_rf_irna_whistle6$p1*40) - mean(prediciton_cla_rf_irna_whistle5$p1*40) + mean_ycount_on_training), 1)

(mse <- mean((as.vector(as.numeric(prediciton_cla_rf_irna_whistle6$Yor))-as.vector(prediciton_cla_rf_irna_whistle6$pred))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_rf_irna_whistle6$Yor)), as.vector(prediciton_cla_rf_irna_whistle6$pred)))))
```

#cla_glm_all9
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_all),5)

#preperation
data <- Model_matrix_all
pred_cla_glm_all <- data.frame()   
aba_cla_glm_all <- data.frame()
prediciton <-data.frame()
importance_cla_glm_all<-data.frame()

#5-fold
  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
    #Store corresponding count(authenticated)
    aba_cla_glm_all <- rbind(aba_cla_glm_all,subset(as.data.frame(test),select =Yor))
      #model
      M_cla_glm_all<- h2o.glm(x = predictors_all, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  seed = 123)
                                     
    #prediction--generate p1
    prediction <- h2o.predict(object = M_cla_glm_all, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_cla_glm_all <- rbind(pred_cla_glm_all,temp)  
    #feature importance
    if(i==1){
      importance_cla_glm_all <- h2o.varimp(M_cla_glm_all)[c("variable","percentage")]
      names(importance_cla_glm_all)[names(importance_cla_glm_all) == "percentage"] <- "percentage1"
            }else{
      importance_cla_glm_all <- merge(x=importance_cla_glm_all,y=h2o.varimp(M_cla_glm_all)[c("variable","percentage")],by="variable")
      names(importance_cla_glm_all)[names(importance_cla_glm_all) == "percentage"] <- paste0("percentage",i)
                  }
    #save model
    setwd("~/Model")
    saveRDS(M_cla_glm_all,paste0("M_cla_glm_irna_whistle_",i,".rds"))
  }

#for table1--auc mcc
library(ROCR)
pred <- prediction(as.numeric(pred_cla_glm_all$p1), as.numeric(pred_cla_glm_all$Y))
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)

#for table3
print("-------------------------------table3")
prediciton_cla_glm_all3<-data.frame()
prediciton_cla_glm_all3<- cbind(as.data.frame(pred_cla_glm_all$p1),as.data.frame(aba_cla_glm_all$Yor))
names(prediciton_cla_glm_all3)[names(prediciton_cla_glm_all3) == 'aba_cla_glm_all$Yor'] <- 'Yor'
names(prediciton_cla_glm_all3)[names(prediciton_cla_glm_all3) == 'pred_cla_glm_all$p1'] <- 'p1'

(mse <- mean((as.vector(as.numeric(prediciton_cla_glm_all3$Yor))-as.vector(40*prediciton_cla_glm_all3$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_glm_all3$Yor)), as.vector(40*prediciton_cla_glm_all3$p1)))))

#plot
importance_cla_glm_all$mean <- apply(importance_cla_glm_all[,2:6], 1, mean)
importance_cla_glm_all$sd <- apply(importance_cla_glm_all[,2:6], 1, sd)
library(ggplot2)
P_importance_cla_glm_all <-importance_cla_glm_all[c("variable","mean","sd")] 
P_importance_cla_glm_all<- P_importance_cla_glm_all[order(P_importance_cla_glm_all$mean,decreasing=TRUE),][1:20,]

plot_cla_glm_all <- ggplot(P_importance_cla_glm_all[order(P_importance_cla_glm_all$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="GLM  Model for Classification(iRNA & Genomic & Regulator)", x="Feature(iRNA & Genomic & Regulator)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```

```{r}
#table5
w<- which(prediciton_cla_glm_all3$Yor==0)
prediciton_cla_glm_all5<- prediciton_cla_glm_all3[-w,]

(mse <- mean((as.vector(as.numeric(prediciton_cla_glm_all5$Yor))-as.vector(40*prediciton_cla_glm_all5$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_glm_all5$Yor)), as.vector(40*prediciton_cla_glm_all5$p1)))))

```
```{r}
#table6
prediciton_cla_glm_all6 <- prediciton_cla_glm_all5
prediciton_cla_glm_all6$pred <- pmax( round( (prediciton_cla_glm_all6$p1*40) - mean(prediciton_cla_glm_all5$p1*40) + mean_ycount_on_training), 1)

(mse <- mean((as.vector(as.numeric(prediciton_cla_glm_all6$Yor))-as.vector(prediciton_cla_glm_all6$pred))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_glm_all6$Yor)), as.vector(prediciton_cla_glm_all6$pred)))))
```
#cla_dl_all10
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_all),5)

#preperation
data <- Model_matrix_all
pred_cla_dl_all <- data.frame()   
aba_cla_dl_all <- data.frame()
prediciton <-data.frame()
importance_cla_dl_all<-data.frame()

#5-fold
  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
    #Store corresponding count(authenticated)
    aba_cla_dl_all <- rbind(aba_cla_dl_all,subset(as.data.frame(test),select =Yor))
    
    #model
     M_cla_dl_all<- h2o.deeplearning(x = predictors_all, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  hidden = c(1),
                                                  seed = 1234)
    #prediction--generate p1
    prediction <- h2o.predict(object = M_cla_dl_all, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_cla_dl_all <- rbind(pred_cla_dl_all,temp)  
    #feature importance
    if(i==1){
      importance_cla_dl_all <- h2o.varimp(M_cla_dl_all)[c("variable","percentage")]
      names(importance_cla_dl_all)[names(importance_cla_dl_all) == "percentage"] <- "percentage1"
            }else{
      importance_cla_dl_all <- merge(x=importance_cla_dl_all,y=h2o.varimp(M_cla_dl_all)[c("variable","percentage")],by="variable")
      names(importance_cla_dl_all)[names(importance_cla_dl_all) == "percentage"] <- paste0("percentage",i)
                  }
    #save model
    setwd("~/Model")
    saveRDS(M_cla_dl_all,paste0("M_cla_dl_all_",i,".rds"))
  }

#for table1--auc mcc
library(ROCR)
pred <- prediction(as.numeric(pred_cla_dl_all$p1), as.numeric(pred_cla_dl_all$Y))
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)

#for table3
print("-------------------------------table3")
prediciton_cla_dl_all3<-data.frame()
prediciton_cla_dl_all3<- cbind(as.data.frame(pred_cla_dl_all$p1),as.data.frame(aba_cla_dl_all$Yor))
names(prediciton_cla_dl_all3)[names(prediciton_cla_dl_all3) == 'aba_cla_dl_all$Yor'] <- 'Yor'
names(prediciton_cla_dl_all3)[names(prediciton_cla_dl_all3) == 'pred_cla_dl_all$p1'] <- 'p1'

(mse <- mean((as.vector(as.numeric(prediciton_cla_dl_all3$Yor))-as.vector(40*prediciton_cla_dl_all3$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_dl_all3$Yor)), as.vector(40*prediciton_cla_dl_all3$p1)))))

#plot
importance_cla_dl_all$mean <- apply(importance_cla_dl_all[,2:6], 1, mean)
importance_cla_dl_all$sd <- apply(importance_cla_dl_all[,2:6], 1, sd)
library(ggplot2)
P_importance_cla_dl_all <-importance_cla_dl_all[c("variable","mean","sd")] 
P_importance_cla_dl_all<- P_importance_cla_dl_all[order(P_importance_cla_dl_all$mean,decreasing=TRUE),][1:20,]

plot_cla_dl_all <- ggplot(P_importance_cla_dl_all[order(P_importance_cla_dl_all$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="MLP  Model for Classification (iRNA & Genomic & Regulator)", x="Feature (iRNA & Genomic & Regulator)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```
```{r}
#table5
w<- which(prediciton_cla_dl_all3$Yor==0)
prediciton_cla_dl_all5<- prediciton_cla_dl_all3[-w,]

(mse <- mean((as.vector(as.numeric(prediciton_cla_dl_all5$Yor))-as.vector(40*prediciton_cla_dl_all5$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_dl_all5$Yor)), as.vector(40*prediciton_cla_dl_all5$p1)))))

```
```{r}
#table6
prediciton_cla_dl_all6 <- prediciton_cla_dl_all5
prediciton_cla_dl_all6$pred <- pmax( round( (prediciton_cla_dl_all6$p1*40) - mean(prediciton_cla_dl_all5$p1*40) + mean_ycount_on_training), 1)

(mse <- mean((as.vector(as.numeric(prediciton_cla_dl_all6$Yor))-as.vector(prediciton_cla_dl_all6$pred))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_dl_all6$Yor)), as.vector(prediciton_cla_dl_all6$pred)))))
```
#cla_xgboost_all11
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_all),5)

#preperation
data <- Model_matrix_all
pred_cla_xgboost_all <- data.frame()   
aba_cla_xgboost_all <- data.frame()
prediciton <-data.frame()
importance_cla_xgboost_all<-data.frame()

#5-fold
  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
    #Store corresponding count(authenticated)
    aba_cla_xgboost_all <- rbind(aba_cla_xgboost_all,subset(as.data.frame(test),select =Yor))
    
    #model
      M_cla_xgboost_all <- h2o.xgboost(x = predictors_all, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  learn_rate = 0.05,
                                                  gamma = 5,
                                                  max_depth = 5,
                                                  reg_alpha = 10,
                                                  reg_lambda = 10,
                                                  colsample_bytree = 0.3,
                                                  booster = "gbtree", 
                                                  normalize_type = "tree",
                                                  seed = 1234)
    #prediction--generate p1
    prediction <- h2o.predict(object = M_cla_xgboost_all, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_cla_xgboost_all <- rbind(pred_cla_xgboost_all,temp)  
    #feature importance
    if(i==1){
      importance_cla_xgboost_all <- h2o.varimp(M_cla_xgboost_all)[c("variable","percentage")]
      names(importance_cla_xgboost_all)[names(importance_cla_xgboost_all) == "percentage"] <- "percentage1"
            }else{
      importance_cla_xgboost_all <- merge(x=importance_cla_xgboost_all,y=h2o.varimp(M_cla_xgboost_all)[c("variable","percentage")],by="variable")
      names(importance_cla_xgboost_all)[names(importance_cla_xgboost_all) == "percentage"] <- paste0("percentage",i)
                  }
    #save model
    setwd("~/Model")
    saveRDS(M_cla_xgboost_all,paste0("M_cla_xgboost_all_",i,".rds"))
  }

#for table1--auc mcc
library(ROCR)
pred <- prediction(as.numeric(pred_cla_xgboost_all$p1), as.numeric(pred_cla_xgboost_all$Y))
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)

#for table3
print("-------------------------------table3")
prediciton_cla_xgboost_all3<-data.frame()
prediciton_cla_xgboost_all3<- cbind(as.data.frame(pred_cla_xgboost_all$p1),as.data.frame(aba_cla_xgboost_all$Yor))
names(prediciton_cla_xgboost_all3)[names(prediciton_cla_xgboost_all3) == 'aba_cla_xgboost_all$Yor'] <- 'Yor'
names(prediciton_cla_xgboost_all3)[names(prediciton_cla_xgboost_all3) == 'pred_cla_xgboost_all$p1'] <- 'p1'

(mse <- mean((as.vector(as.numeric(prediciton_cla_xgboost_all3$Yor))-as.vector(40*prediciton_cla_xgboost_all3$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_xgboost_all3$Yor)), as.vector(40*prediciton_cla_xgboost_all3$p1)))))

#plot
importance_cla_xgboost_all$mean <- apply(importance_cla_xgboost_all[,2:6], 1, mean)
importance_cla_xgboost_all$sd <- apply(importance_cla_xgboost_all[,2:6], 1, sd)
library(ggplot2)
P_importance_cla_xgboost_all <-importance_cla_xgboost_all[c("variable","mean","sd")] 
P_importance_cla_xgboost_all<- P_importance_cla_xgboost_all[order(P_importance_cla_xgboost_all$mean,decreasing=TRUE),][1:20,]

plot_cla_xgboost_all <- ggplot(P_importance_cla_xgboost_all[order(P_importance_cla_xgboost_all$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="XGBoost Model for Classification (iRNA & Genomic & Regulator)", x="Feature (iRNA & Genomic & Regulator)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```
```{r}
#table5
w<- which(prediciton_cla_xgboost_all3$Yor==0)
prediciton_cla_xgboost_all5<- prediciton_cla_xgboost_all3[-w,]

(mse <- mean((as.vector(as.numeric(prediciton_cla_xgboost_all5$Yor))-as.vector(40*prediciton_cla_xgboost_all5$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_xgboost_all5$Yor)), as.vector(40*prediciton_cla_xgboost_all5$p1)))))

```
```{r}
#table6
prediciton_cla_xgboost_all6 <- prediciton_cla_xgboost_all5
prediciton_cla_xgboost_all6$pred <- pmax( round( (prediciton_cla_xgboost_all6$p1*40) - mean(prediciton_cla_xgboost_all5$p1*40) + mean_ycount_on_training), 1)

(mse <- mean((as.vector(as.numeric(prediciton_cla_xgboost_all6$Yor))-as.vector(prediciton_cla_xgboost_all6$pred))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_xgboost_all6$Yor)), as.vector(prediciton_cla_xgboost_all6$pred)))))
```
#cla_rf_all12
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_all),5)

#preperation
data <- Model_matrix_all
pred_cla_rf_all <- data.frame()   
aba_cla_rf_all <- data.frame()
prediciton <-data.frame()
importance_cla_rf_all<-data.frame()

#5-fold
  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
    #Store corresponding count(authenticated)
    aba_cla_rf_all <- rbind(aba_cla_rf_all,subset(as.data.frame(test),select =Yor))
    
    #model
    M_cla_rf_all <- h2o.randomForest(
                   x = predictors_all,
                   y = "Y",
                   training_frame= as.h2o(train),
                   ntrees = 20,
                   max_depth = 10,
                    seed = 1234,
                   min_rows = 1
 )

    #prediction--generate p1
    prediction <- h2o.predict(object = M_cla_rf_all, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_cla_rf_all <- rbind(pred_cla_rf_all,temp)  
    #feature importance
    if(i==1){
      importance_cla_rf_all <- h2o.varimp(M_cla_rf_all)[c("variable","percentage")]
      names(importance_cla_rf_all)[names(importance_cla_rf_all) == "percentage"] <- "percentage1"
            }else{
      importance_cla_rf_all <- merge(x=importance_cla_rf_all,y=h2o.varimp(M_cla_rf_all)[c("variable","percentage")],by="variable")
      names(importance_cla_rf_all)[names(importance_cla_rf_all) == "percentage"] <- paste0("percentage",i)
                  }
    #save model
    setwd("~/Model")
    saveRDS(M_cla_rf_all,paste0("M_cla_rf_all_",i,".rds"))
  }

#for table1--auc mcc
library(ROCR)
pred <- prediction(as.numeric(pred_cla_rf_all$p1), as.numeric(pred_cla_rf_all$Y))
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)

#for table3
print("-------------------------------table3")
prediciton_cla_rf_all3<-data.frame()
prediciton_cla_rf_all3<- cbind(as.data.frame(pred_cla_rf_all$p1),as.data.frame(aba_cla_rf_all$Yor))
names(prediciton_cla_rf_all3)[names(prediciton_cla_rf_all3) == 'aba_cla_rf_all$Yor'] <- 'Yor'
names(prediciton_cla_rf_all3)[names(prediciton_cla_rf_all3) == 'pred_cla_rf_all$p1'] <- 'p1'

(mse <- mean((as.vector(as.numeric(prediciton_cla_rf_all3$Yor))-as.vector(40*prediciton_cla_rf_all3$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_rf_all3$Yor)), as.vector(40*prediciton_cla_rf_all3$p1)))))

#plot
importance_cla_rf_all$mean <- apply(importance_cla_rf_all[,2:6], 1, mean)
importance_cla_rf_all$sd <- apply(importance_cla_rf_all[,2:6], 1, sd)
library(ggplot2)
P_importance_cla_rf_all <-importance_cla_rf_all[c("variable","mean","sd")] 
P_importance_cla_rf_all<- P_importance_cla_rf_all[order(P_importance_cla_rf_all$mean,decreasing=TRUE),][1:20,]

plot_cla_rf_all <- ggplot(P_importance_cla_rf_all[order(P_importance_cla_rf_all$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="RF  Model for Classification
 (iRNA & Genomic & Regulator)", x="Feature(iRNA & Genomic & Regulator)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```
```{r}
#table5
w<- which(prediciton_cla_rf_all3$Yor==0)
prediciton_cla_rf_all5<- prediciton_cla_rf_all3[-w,]

(mse <- mean((as.vector(as.numeric(prediciton_cla_rf_all5$Yor))-as.vector(40*prediciton_cla_rf_all5$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_rf_all5$Yor)), as.vector(40*prediciton_cla_rf_all5$p1)))))

```
```{r}
#table6
prediciton_cla_rf_all6 <- prediciton_cla_rf_all5
prediciton_cla_rf_all6$pred <- pmax( round( (prediciton_cla_rf_all6$p1*40) - mean(prediciton_cla_rf_all5$p1*40) + mean_ycount_on_training), 1)

(mse <- mean((as.vector(as.numeric(prediciton_cla_rf_all6$Yor))-as.vector(prediciton_cla_rf_all6$pred))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_rf_all6$Yor)), as.vector(prediciton_cla_rf_all6$pred)))))
```

#reg_glm_irna13
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_or_matrix_irna),5)

data <- Model_or_matrix_irna
pred_reg_glm_irna <- data.frame()   
importance_reg_glm_irna<-data.frame()

  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
      M_reg_glm_irna <- h2o.glm(x = predictors_irna, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  family ="poisson",
                                                  seed = 1234)
    
    prediction <- h2o.predict(object = M_reg_glm_irna, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_glm_irna <- rbind(pred_reg_glm_irna,temp) 
        #feature importance
    if(i==1){
      importance_reg_glm_irna <- h2o.varimp(M_reg_glm_irna)[c("variable","percentage")]
      names(importance_reg_glm_irna)[names(importance_reg_glm_irna) == "percentage"] <- "percentage1"
            }else{
      importance_reg_glm_irna <- merge(x=importance_reg_glm_irna,y=h2o.varimp(M_reg_glm_irna)[c("variable","percentage")],by="variable")
      names(importance_reg_glm_irna)[names(importance_reg_glm_irna) == "percentage"] <- paste0("percentage",i)
            }
    #save model
    setwd("~/Model")
    saveRDS(M_reg_glm_irna,paste0("M_reg_glm_irna_",i,".rds"))
  }
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_glm_irna$Y), as.vector(pred_reg_glm_irna$predict)))))
    (mse <- mean((as.vector(pred_reg_glm_irna$Y)-as.vector(pred_reg_glm_irna$predict))^2))
#plot
importance_reg_glm_irna$mean <- apply(importance_reg_glm_irna[,2:6], 1, mean)
importance_reg_glm_irna$sd <- apply(importance_reg_glm_irna[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_glm_irna <-importance_reg_glm_irna[c("variable","mean","sd")] 
P_importance_reg_glm_irna<- P_importance_reg_glm_irna[order(P_importance_reg_glm_irna$mean,decreasing=TRUE),][1:20,]

plot_reg_glm_irna <- ggplot(P_importance_reg_glm_irna[order(P_importance_reg_glm_irna$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="GLM  Model for Poisson Regression (iRNA)", x="Feature (iRNA)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
    
```
```{r}
#test
kpred_reg_glm_irna <- pred_reg_glm_irna
kpred_reg_glm_irna$predict<- kpred_reg_glm_irna$predict/max(kpred_reg_glm_irna$predict)
kpred_reg_glm_irna$Y[which(pred_reg_glm_irna$Y>0)] <- 1

library(ROCR)
pred <- prediction(kpred_reg_glm_irna$predict, kpred_reg_glm_irna$Y)
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)
```
#reg_dl_irna14
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_or_matrix_irna),5)

data <- Model_or_matrix_irna
pred_reg_dl_irna <- data.frame() 
importance_reg_dl_irna<-data.frame()


  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
      M_reg_dl_irna <- h2o.deeplearning(x = predictors_irna, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  hidden = c(1),
                                                  distribution = "poisson",                           
                                                  seed = 1234)
                                     
    
    prediction <- h2o.predict(object = M_reg_dl_irna, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_dl_irna <- rbind(pred_reg_dl_irna,temp)
    #feature importance
    if(i==1){
      importance_reg_dl_irna <- h2o.varimp(M_reg_dl_irna)[c("variable","percentage")]
      names(importance_reg_dl_irna)[names(importance_reg_dl_irna) == "percentage"] <- "percentage1"
            }else{
      importance_reg_dl_irna <- merge(x=importance_reg_dl_irna,y=h2o.varimp(M_reg_dl_irna)[c("variable","percentage")],by="variable")
      names(importance_reg_dl_irna)[names(importance_reg_dl_irna) == "percentage"] <- paste0("percentage",i)
            }
    #model
    setwd("~/Model")
    saveRDS(M_reg_dl_irna,paste0("M_reg_dl_irna_",i,".rds"))
  }
    (mse <- mean((as.vector(pred_reg_dl_irna$Y)-as.vector(pred_reg_dl_irna$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_dl_irna$Y), as.vector(pred_reg_dl_irna$predict)))))
#plot
importance_reg_dl_irna$mean <- apply(importance_reg_dl_irna[,2:6], 1, mean)
importance_reg_dl_irna$sd <- apply(importance_reg_dl_irna[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_dl_irna <-importance_reg_dl_irna[c("variable","mean","sd")] 
P_importance_reg_dl_irna<- P_importance_reg_dl_irna[order(P_importance_reg_dl_irna$mean,decreasing=TRUE),][1:20,]

plot_reg_dl_irna <- ggplot(P_importance_reg_dl_irna[order(P_importance_reg_dl_irna$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="MLP  Model for Poisson Regression (iRNA)", x="Feature (iRNA)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
    
    
```

```{r}
#test
kpred_reg_dl_irna <-pred_reg_dl_irna
kpred_reg_dl_irna$predict<- kpred_reg_dl_irna$predict/max(kpred_reg_dl_irna$predict)
kpred_reg_dl_irna$Y[which(pred_reg_dl_irna$Y>0)] <- 1

library(ROCR)
pred <- prediction(kpred_reg_dl_irna$predict, kpred_reg_dl_irna$Y)
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)
```
#reg_xgboost_irna15
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_or_matrix_irna),5)

data <- Model_or_matrix_irna
pred_reg_xgboost_irna <- data.frame()   
importance_reg_xgboost_irna<-data.frame()

  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
      M_reg_xgboost_irna <- h2o.xgboost(x = predictors_irna, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  learn_rate = 0.05,
                                                  gamma = 5,
                                                  max_depth = 5,
                                                  reg_alpha = 10,
                                                  reg_lambda = 10,
                                                  colsample_bytree = 0.3,
                                                  booster = "gbtree", 
                                                  normalize_type = "tree",
                                                  distribution = "poisson",
                                                  seed = 1234)
                                     
    
    prediction <- h2o.predict(object = M_reg_xgboost_irna, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_xgboost_irna <- rbind(pred_reg_xgboost_irna,temp)
    
    #feature importance
    
    if(i==1){
      importance_reg_xgboost_irna <- h2o.varimp(M_reg_xgboost_irna)[c("variable","percentage")]
      names(importance_reg_xgboost_irna)[names(importance_reg_xgboost_irna) == "percentage"] <- "percentage1"
            }else{
      importance_reg_xgboost_irna <- merge(x=importance_reg_xgboost_irna,y=h2o.varimp(M_reg_xgboost_irna)[c("variable","percentage")],by="variable")
      names(importance_reg_xgboost_irna)[names(importance_reg_xgboost_irna) == "percentage"] <- paste0("percentage",i)
            }
    
    #save model
    setwd("~/Model")
    saveRDS(M_reg_xgboost_irna,paste0("M_reg_xgboost_irna_",i,".rds"))    
  }

    (mse <- mean((as.vector(pred_reg_xgboost_irna$Y)-as.vector(pred_reg_xgboost_irna$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_xgboost_irna$Y), as.vector(pred_reg_xgboost_irna$predict)))))   

#plot
importance_reg_xgboost_irna$mean <- apply(importance_reg_xgboost_irna[,2:6], 1, mean)
importance_reg_xgboost_irna$sd <- apply(importance_reg_xgboost_irna[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_xgboost_irna <-importance_reg_xgboost_irna[c("variable","mean","sd")] 
P_importance_reg_xgboost_irna<- P_importance_reg_xgboost_irna[order(P_importance_reg_xgboost_irna$mean,decreasing=TRUE),][1:20,]

plot_reg_xgboost_irna <- ggplot(P_importance_reg_xgboost_irna[order(P_importance_reg_xgboost_irna$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="XGBoost Model for Poisson Regression (iRNA)", x="Feature (iRNA)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
    
```
```{r}
#test
kpred_reg_xgboost_irna <-pred_reg_xgboost_irna
kpred_reg_xgboost_irna$predict<- kpred_reg_xgboost_irna$predict/max(kpred_reg_xgboost_irna$predict)
kpred_reg_xgboost_irna$Y[which(pred_reg_xgboost_irna$Y>0)] <- 1

library(ROCR)
pred <- prediction(kpred_reg_xgboost_irna$predict, kpred_reg_xgboost_irna$Y)
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)
```
#reg_rf_irna16
```{r}

library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_or_matrix_irna),5)

data <- Model_or_matrix_irna
pred_reg_rf_irna <- data.frame()   
importance_reg_rf_irna<-data.frame()

  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
    M_reg_rf_irna <- h2o.randomForest(
                   x = predictors_irna,
                   y = "Y",
                   training_frame= as.h2o(train),
                   ntrees = 20,
                   max_depth = 10,
                    seed = 1234,
                   min_rows = 1
    )
                                     
    
    prediction <- h2o.predict(object = M_reg_rf_irna, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_rf_irna <- rbind(pred_reg_rf_irna,temp)
    
    #feature importance
    
    if(i==1){
      importance_reg_rf_irna <- h2o.varimp(M_reg_rf_irna)[c("variable","percentage")]
      names(importance_reg_rf_irna)[names(importance_reg_rf_irna) == "percentage"] <- "percentage1"
            }else{
      importance_reg_rf_irna <- merge(x=importance_reg_rf_irna,y=h2o.varimp(M_reg_rf_irna)[c("variable","percentage")],by="variable")
      names(importance_reg_rf_irna)[names(importance_reg_rf_irna) == "percentage"] <- paste0("percentage",i)
            }
    
    #save model
    setwd("~/Model")
    saveRDS(M_reg_rf_irna,paste0("M_reg_rf_irna_",i,".rds"))    
  }

    (mse <- mean((as.vector(pred_reg_rf_irna$Y)-as.vector(pred_reg_rf_irna$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_rf_irna$Y), as.vector(pred_reg_rf_irna$predict)))))   

#plot
importance_reg_rf_irna$mean <- apply(importance_reg_rf_irna[,2:6], 1, mean)
importance_reg_rf_irna$sd <- apply(importance_reg_rf_irna[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_rf_irna <-importance_reg_rf_irna[c("variable","mean","sd")] 
P_importance_reg_rf_irna<- P_importance_reg_rf_irna[order(P_importance_reg_rf_irna$mean,decreasing=TRUE),][1:20,]

plot_reg_rf_irna <- ggplot(P_importance_reg_rf_irna[order(P_importance_reg_rf_irna$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="RF  Model for Poisson Regression (iRNA)", x="Feature (iRNA)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```

```{r}
#test
kpred_reg_rf_irna <-pred_reg_rf_irna
kpred_reg_rf_irna$predict<- kpred_reg_rf_irna$predict/max(kpred_reg_xgboost_irna$predict)
kpred_reg_rf_irna$Y[which(kpred_reg_rf_irna$Y>0)] <- 1

library(ROCR)
pred <- prediction(kpred_reg_rf_irna$predict, kpred_reg_rf_irna$Y)
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)
```
#reg_glm_irna_whistle17
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_or_matrix_irna_whistle),5)

data <- Model_or_matrix_irna_whistle
pred_reg_glm_irna_whistle <- data.frame()   
importance_reg_glm_irna_whistle<-data.frame()

  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
      M_reg_glm_irna_whistle <- h2o.glm(x = predictors_irna_whistle, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  family ="poisson",
                                                  seed = 1234)
                                     
    
    prediction <- h2o.predict(object = M_reg_glm_irna_whistle, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_glm_irna_whistle <- rbind(pred_reg_glm_irna_whistle,temp) 
    
     #feature importance
    
    if(i==1){
      importance_reg_glm_irna_whistle <- h2o.varimp(M_reg_glm_irna_whistle)[c("variable","percentage")]
      names(importance_reg_glm_irna_whistle)[names(importance_reg_glm_irna_whistle) == "percentage"] <- "percentage1"
            }else{
      importance_reg_glm_irna_whistle <- merge(x=importance_reg_glm_irna_whistle,y=h2o.varimp(M_reg_glm_irna_whistle)[c("variable","percentage")],by="variable")
      names(importance_reg_glm_irna_whistle)[names(importance_reg_glm_irna_whistle) == "percentage"] <- paste0("percentage",i)
            }
    
    #save model
    setwd("~/Model")
    saveRDS(M_reg_glm_irna_whistle,paste0("M_reg_glm_irna_whistle_",i,".rds"))
  }

    (mse <- mean((as.vector(pred_reg_glm_irna_whistle$Y)-as.vector(pred_reg_glm_irna_whistle$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_glm_irna_whistle$Y), as.vector(pred_reg_glm_irna_whistle$predict)))))
#plot
importance_reg_glm_irna_whistle$mean <- apply(importance_reg_glm_irna_whistle[,2:6], 1, mean)
importance_reg_glm_irna_whistle$sd <- apply(importance_reg_glm_irna_whistle[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_glm_irna_whistle <-importance_reg_glm_irna_whistle[c("variable","mean","sd")] 
P_importance_reg_glm_irna_whistle<- P_importance_reg_glm_irna_whistle[order(P_importance_reg_glm_irna_whistle$mean,decreasing=TRUE),][1:20,]

plot_reg_glm_irna_whistle <- ggplot(P_importance_reg_glm_irna_whistle[order(P_importance_reg_glm_irna_whistle$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="GLM  Model for Poisson Regression (iRNA & Genomic)", x="Feature (iRNA & Genomic)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```
```{r}
#test
kpred_reg_glm_irna_whistle <-pred_reg_glm_irna_whistle
kpred_reg_glm_irna_whistle$predict<- kpred_reg_glm_irna_whistle$predict/max(kpred_reg_glm_irna_whistle$predict)
kpred_reg_glm_irna_whistle$Y[which(kpred_reg_glm_irna_whistle$Y>0)] <- 1

library(ROCR)
pred <- prediction(kpred_reg_glm_irna_whistle$predict, kpred_reg_glm_irna_whistle$Y)
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)
```
#reg_dl_irna_whistle18
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_or_matrix_irna_whistle),5)

data <- Model_or_matrix_irna_whistle
pred_reg_dl_irna_whistle <- data.frame()   
importance_reg_dl_irna_whistle<-data.frame()

  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
      M_reg_dl_irna_whistle <- h2o.deeplearning(x = predictors_irna_whistle, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  distribution = "poisson",
                                                  hidden = c(1),
                                                  seed = 1234)
                                     
    
    prediction <- h2o.predict(object = M_reg_dl_irna_whistle, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_dl_irna_whistle <- rbind(pred_reg_dl_irna_whistle,temp)
    
    #feature importance
    if(i==1){
      importance_reg_dl_irna_whistle <- h2o.varimp(M_reg_dl_irna_whistle)[c("variable","percentage")]
      names(importance_reg_dl_irna_whistle)[names(importance_reg_dl_irna_whistle) == "percentage"] <- "percentage1"
            }else{
      importance_reg_dl_irna_whistle <- merge(x=importance_reg_dl_irna_whistle,y=h2o.varimp(M_reg_dl_irna_whistle)[c("variable","percentage")],by="variable")
      names(importance_reg_dl_irna_whistle)[names(importance_reg_dl_irna_whistle) == "percentage"] <- paste0("percentage",i)
            }
    #save model
    setwd("~/Model")
    saveRDS(M_reg_dl_irna_whistle,paste0("M_reg_dl_irna_whistle_",i,".rds"))
  }

    (mse <- mean((as.vector(pred_reg_dl_irna_whistle$Y)-as.vector(pred_reg_dl_irna_whistle$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_dl_irna_whistle$Y), as.vector(pred_reg_dl_irna_whistle$predict))))) 

#plot
importance_reg_dl_irna_whistle$mean <- apply(importance_reg_dl_irna_whistle[,2:6], 1, mean)
importance_reg_dl_irna_whistle$sd <- apply(importance_reg_dl_irna_whistle[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_dl_irna_whistle <-importance_reg_dl_irna_whistle[c("variable","mean","sd")] 
P_importance_reg_dl_irna_whistle<- P_importance_reg_dl_irna_whistle[order(P_importance_reg_dl_irna_whistle$mean,decreasing=TRUE),][1:20,]

plot_reg_dl_irna_whistle <- ggplot(P_importance_reg_dl_irna_whistle[order(P_importance_reg_dl_irna_whistle$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="MLP  Model for Poisson Regression (iRNA & Genomic)", x="Feature (iRNA & Genomic)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```
```{r}
#test
kpred_reg_dl_irna_whistle  <-pred_reg_dl_irna_whistle 
kpred_reg_dl_irna_whistle $predict<- kpred_reg_dl_irna_whistle $predict/max(kpred_reg_dl_irna_whistle $predict)
kpred_reg_dl_irna_whistle $Y[which(kpred_reg_dl_irna_whistle $Y>0)] <- 1

library(ROCR)
pred <- prediction(kpred_reg_dl_irna_whistle $predict, kpred_reg_dl_irna_whistle $Y)
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)
```
#reg_xgboost_irna_whistle19
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_or_matrix_irna_whistle),5)

data <- Model_or_matrix_irna_whistle
pred_reg_xgboost_irna_whistle <- data.frame() 
importance_reg_xgboost_irna_whistle<-data.frame()


  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
      M_reg_xgboost_irna_whistle <- h2o.xgboost(x = predictors_irna_whistle, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  learn_rate = 0.05,
                                                  gamma = 5,
                                                  max_depth = 5,
                                                  reg_alpha = 10,
                                                  reg_lambda = 10,
                                                  colsample_bytree = 0.3,
                                                  booster = "gbtree", 
                                                  normalize_type = "tree",
                                                  distribution = "poisson",
                                                  seed = 1234)
                                     
    
    prediction <- h2o.predict(object = M_reg_xgboost_irna_whistle, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_xgboost_irna_whistle <- rbind(pred_reg_xgboost_irna_whistle,temp) 
    
   #feature importance
    if(i==1){
      importance_reg_xgboost_irna_whistle <- h2o.varimp(M_reg_xgboost_irna_whistle)[c("variable","percentage")]
      names(importance_reg_xgboost_irna_whistle)[names(importance_reg_xgboost_irna_whistle) == "percentage"] <- "percentage1"
            }else{
      importance_reg_xgboost_irna_whistle <- merge(x=importance_reg_xgboost_irna_whistle,y=h2o.varimp(M_reg_xgboost_irna_whistle)[c("variable","percentage")],by="variable")
      names(importance_reg_xgboost_irna_whistle)[names(importance_reg_xgboost_irna_whistle) == "percentage"] <- paste0("percentage",i)
            }
    
    #save model
    setwd("~/Model")
    saveRDS(M_reg_xgboost_irna_whistle,paste0("M_reg_xgboost_irna_whistle_",i,".rds"))
  }

    (mse <- mean((as.vector(pred_reg_xgboost_irna_whistle$Y)-as.vector(pred_reg_xgboost_irna_whistle$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_xgboost_irna_whistle$Y), as.vector(pred_reg_xgboost_irna_whistle$predict)))))  
#plot
importance_reg_xgboost_irna_whistle$mean <- apply(importance_reg_xgboost_irna_whistle[,2:6], 1, mean)
importance_reg_xgboost_irna_whistle$sd <- apply(importance_reg_xgboost_irna_whistle[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_xgboost_irna_whistle <-importance_reg_xgboost_irna_whistle[c("variable","mean","sd")] 
P_importance_reg_xgboost_irna_whistle<- P_importance_reg_xgboost_irna_whistle[order(P_importance_reg_xgboost_irna_whistle$mean,decreasing=TRUE),][1:20,]

plot_reg_xgboost_irna_whistle <- ggplot(P_importance_reg_xgboost_irna_whistle[order(P_importance_reg_xgboost_irna_whistle$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="XGBoost Model for Poisson Regression (iRNA & Genomic)", x="Feature (iRNA & Genomic)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```
```{r}
#test
kpred_reg_xgboost_irna_whistle   <-pred_reg_xgboost_irna_whistle  
kpred_reg_xgboost_irna_whistle$predict<- kpred_reg_xgboost_irna_whistle$predict/max(kpred_reg_xgboost_irna_whistle $predict)
kpred_reg_xgboost_irna_whistle$Y[which(kpred_reg_xgboost_irna_whistle$Y>0)] <- 1

library(ROCR)
pred <- prediction(kpred_reg_xgboost_irna_whistle$predict, kpred_reg_xgboost_irna_whistle$Y)
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)
```
#reg_rf_irna_whistle20
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_or_matrix_irna_whistle),5)

data <- Model_or_matrix_irna_whistle
pred_reg_rf_irna_whistle <- data.frame()   
importance_reg_rf_irna_whistle<-data.frame()

  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
    M_reg_rf_irna_whistle <- h2o.randomForest(
                   x = predictors_irna_whistle,
                   y = "Y",
                   training_frame= as.h2o(train),
                   ntrees = 20,
                   max_depth = 10,
                    seed = 1234,
                   min_rows = 1
    )
                                     
    
    prediction <- h2o.predict(object = M_reg_rf_irna_whistle, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_rf_irna_whistle <- rbind(pred_reg_rf_irna_whistle,temp)
    
    #feature importance
    
    if(i==1){
      importance_reg_rf_irna_whistle <- h2o.varimp(M_reg_rf_irna_whistle)[c("variable","percentage")]
      names(importance_reg_rf_irna_whistle)[names(importance_reg_rf_irna_whistle) == "percentage"] <- "percentage1"
            }else{
      importance_reg_rf_irna_whistle <- merge(x=importance_reg_rf_irna_whistle,y=h2o.varimp(M_reg_rf_irna_whistle)[c("variable","percentage")],by="variable")
      names(importance_reg_rf_irna_whistle)[names(importance_reg_rf_irna_whistle) == "percentage"] <- paste0("percentage",i)
            }
    
    #save model
    setwd("~/Model")
    saveRDS(M_reg_rf_irna_whistle,paste0("M_reg_rf_irna_whistle_",i,".rds"))    
  }

    (mse <- mean((as.vector(pred_reg_rf_irna_whistle$Y)-as.vector(pred_reg_rf_irna_whistle$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_rf_irna_whistle$Y), as.vector(pred_reg_rf_irna_whistle$predict)))))   

#plot
importance_reg_rf_irna_whistle$mean <- apply(importance_reg_rf_irna_whistle[,2:6], 1, mean)
importance_reg_rf_irna_whistle$sd <- apply(importance_reg_rf_irna_whistle[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_rf_irna_whistle <-importance_reg_rf_irna_whistle[c("variable","mean","sd")] 
P_importance_reg_rf_irna_whistle<- P_importance_reg_rf_irna_whistle[order(P_importance_reg_rf_irna_whistle$mean,decreasing=TRUE),][1:20,]

plot_reg_rf_irna_whistle <- ggplot(P_importance_reg_rf_irna_whistle[order(P_importance_reg_rf_irna_whistle$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="RF  Model for Poisson Regression (iRNA & Genomic)", x="Feature(iRNA & Genomic)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```
```{r}
#test
kpred_reg_rf_irna_whistle<-pred_reg_rf_irna_whistle  
kpred_reg_rf_irna_whistle$predict<- kpred_reg_rf_irna_whistle$predict/max(kpred_reg_rf_irna_whistle$predict)
kpred_reg_rf_irna_whistle$Y[which(kpred_reg_rf_irna_whistle$Y>0)] <- 1

library(ROCR)
pred <- prediction(kpred_reg_rf_irna_whistle$predict, kpred_reg_rf_irna_whistle$Y)
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)
```
#reg_glm_all21
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_or_matrix_all),5)

data <- Model_or_matrix_all
pred_reg_glm_all <- data.frame()
importance_reg_glm_all<-data.frame()


  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
      M_reg_glm_all <- h2o.glm(x = predictors_all, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  family ="poisson",
                                                  seed = 1234)
                                     
    
    prediction <- h2o.predict(object = M_reg_glm_all, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_glm_all <- rbind(pred_reg_glm_all,temp)
    
    #feature importance
    if(i==1){
      importance_reg_glm_all <- h2o.varimp(M_reg_glm_all)[c("variable","percentage")]
      names(importance_reg_glm_all)[names(importance_reg_glm_all) == "percentage"] <- "percentage1"
            }else{
      importance_reg_glm_all <- merge(x=importance_reg_glm_all,y=h2o.varimp(M_reg_glm_all)[c("variable","percentage")],by="variable")
      names(importance_reg_glm_all)[names(importance_reg_glm_all) == "percentage"] <- paste0("percentage",i)
            }
    #save model
    setwd("~/Model")
    saveRDS(M_reg_glm_all,paste0("M_reg_glm_all_",i,".rds"))
  }

    (mse <- mean((as.vector(pred_reg_glm_all$Y)-as.vector(pred_reg_glm_all$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_glm_all$Y), as.vector(pred_reg_glm_all$predict)))))
#plot
importance_reg_glm_all$mean <- apply(importance_reg_glm_all[,2:6], 1, mean)
importance_reg_glm_all$sd <- apply(importance_reg_glm_all[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_glm_all <-importance_reg_glm_all[c("variable","mean","sd")] 
P_importance_reg_glm_all<- P_importance_reg_glm_all[order(P_importance_reg_glm_all$mean,decreasing=TRUE),][1:20,]

plot_reg_glm_all <- ggplot(P_importance_reg_glm_all[order(P_importance_reg_glm_all$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="GLM  Model for Poisson Regression (iRNA & Genomic & Regulator)", x="Feature (iRNA & Genomic & Regulator)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```


```{r}
#test
kpred_reg_glm_all<-pred_reg_glm_all  
kpred_reg_glm_all$predict<- kpred_reg_glm_all$predict/max(kpred_reg_glm_all$predict)
kpred_reg_glm_all$Y[which(kpred_reg_glm_all$Y>0)] <- 1

library(ROCR)
pred <- prediction(kpred_reg_glm_all$predict, kpred_reg_glm_all$Y)
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)
```
#reg_dl_all22
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_or_matrix_all),5)

data <- Model_or_matrix_all
pred_reg_dl_all <- data.frame()
importance_reg_dl_all<-data.frame()


  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
      M_reg_dl_all <- h2o.deeplearning(x = predictors_all, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  distribution = "poisson",
                                                  hidden = c(1),
                                                  seed = 1234)
                                     
    
    prediction <- h2o.predict(object = M_reg_dl_all, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_dl_all <- rbind(pred_reg_dl_all,temp) 
    
    #feature importance
    if(i==1){
      importance_reg_dl_all <- h2o.varimp(M_reg_dl_all)[c("variable","percentage")]
      names(importance_reg_dl_all)[names(importance_reg_dl_all) == "percentage"] <- "percentage1"
            }else{
      importance_reg_dl_all <- merge(x=importance_reg_dl_all,y=h2o.varimp(M_reg_dl_all)[c("variable","percentage")],by="variable")
      names(importance_reg_dl_all)[names(importance_reg_dl_all) == "percentage"] <- paste0("percentage",i)
            }
    #save model
    setwd("~/Model")
    saveRDS(M_reg_dl_all,paste0("M_reg_dl_all_",i,".rds"))
  }

    (mse <- mean((as.vector(pred_reg_dl_all$Y)-as.vector(pred_reg_dl_all$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_dl_all$Y), as.vector(pred_reg_dl_all$predict))))) 
#plot
importance_reg_dl_all$mean <- apply(importance_reg_dl_all[,2:6], 1, mean)
importance_reg_dl_all$sd <- apply(importance_reg_dl_all[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_dl_all <-importance_reg_dl_all[c("variable","mean","sd")] 
P_importance_reg_dl_all<- P_importance_reg_dl_all[order(P_importance_reg_dl_all$mean,decreasing=TRUE),][1:20,]

plot_reg_dl_all <- ggplot(P_importance_reg_dl_all[order(P_importance_reg_dl_all$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="MLP  Model for Poisson Regression (iRNA & Genomic & Regulator)", x="Feature (iRNA & Genomic & Regulator)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```
```{r}
#test
kpred_reg_dl_all<-pred_reg_dl_all  
kpred_reg_dl_all$predict<- kpred_reg_dl_all$predict/max(kpred_reg_dl_all$predict)
kpred_reg_dl_all$Y[which(kpred_reg_dl_all$Y>0)] <- 1

library(ROCR)
pred <- prediction(kpred_reg_dl_all$predict, kpred_reg_dl_all$Y)
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)
```
#reg_xgboost_all23
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_or_matrix_all),5)

data <- Model_or_matrix_all
pred_reg_xgboost_all <- data.frame() 
importance_reg_xgboost_all<-data.frame()


  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
      M_reg_xgboost_all <- h2o.xgboost(x = predictors_all, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  learn_rate = 0.05,
                                                  gamma = 5,
                                                  max_depth = 5,
                                                  reg_alpha = 10,
                                                  reg_lambda = 10,
                                                  colsample_bytree = 0.3,
                                                  booster = "gbtree", 
                                                  normalize_type = "tree",
                                                  distribution = "poisson",
                                                  seed = 1234)
                                     
    
    prediction <- h2o.predict(object = M_reg_xgboost_all, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_xgboost_all <- rbind(pred_reg_xgboost_all,temp)
    #feature importance
    if(i==1){
      importance_reg_xgboost_all <- h2o.varimp(M_reg_xgboost_all)[c("variable","percentage")]
      names(importance_reg_xgboost_all)[names(importance_reg_xgboost_all) == "percentage"] <- "percentage1"
            }else{
      importance_reg_xgboost_all <- merge(x=importance_reg_xgboost_all,y=h2o.varimp(M_reg_xgboost_all)[c("variable","percentage")],by="variable")
      names(importance_reg_xgboost_all)[names(importance_reg_xgboost_all) == "percentage"] <- paste0("percentage",i)
            }
    #save model
    setwd("~/Model")
    saveRDS(M_reg_xgboost_all,paste0("M_reg_xgboost_all_",i,".rds"))
  }

    (mse <- mean((as.vector(pred_reg_xgboost_all$Y)-as.vector(pred_reg_xgboost_all$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_xgboost_all$Y), as.vector(pred_reg_xgboost_all$predict)))))  
#plot
importance_reg_xgboost_all$mean <- apply(importance_reg_xgboost_all[,2:6], 1, mean)
importance_reg_xgboost_all$sd <- apply(importance_reg_xgboost_all[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_xgboost_all <-importance_reg_xgboost_all[c("variable","mean","sd")] 
P_importance_reg_xgboost_all<- P_importance_reg_xgboost_all[order(P_importance_reg_xgboost_all$mean,decreasing=TRUE),][1:20,]

plot_reg_xgboost_all <- ggplot(P_importance_reg_xgboost_all[order(P_importance_reg_xgboost_all$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="XGBoost Model for Poisson Regression (iRNA & Genomic & Regulator)", x="Feature (iRNA & Genomic & Regulator)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```
```{r}
#test
kpred_reg_xgboost_all <- pred_reg_xgboost_all
kpred_reg_xgboost_all$predict<- kpred_reg_xgboost_all$predict/max(kpred_reg_xgboost_all$predict)
kpred_reg_xgboost_all$Y[which(kpred_reg_xgboost_all$Y>0)] <- 1

library(ROCR)
pred <- prediction(kpred_reg_xgboost_all$predict, kpred_reg_xgboost_all$Y)
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)
```
#reg_rf_all24
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_or_matrix_all),5)

data <- Model_or_matrix_all
pred_reg_rf_all <- data.frame()   
importance_reg_rf_all<-data.frame()

  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
    M_reg_rf_all <- h2o.randomForest(
                   x = predictors_all,
                   y = "Y",
                   training_frame= as.h2o(train),
                   ntrees = 20,
                   max_depth = 10,
                    seed = 1234,
                   min_rows = 1
    )
                                     
    
    prediction <- h2o.predict(object = M_reg_rf_all, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_rf_all <- rbind(pred_reg_rf_all,temp)
    
    #feature importance
    
    if(i==1){
      importance_reg_rf_all <- h2o.varimp(M_reg_rf_all)[c("variable","percentage")]
      names(importance_reg_rf_all)[names(importance_reg_rf_all) == "percentage"] <- "percentage1"
            }else{
      importance_reg_rf_all <- merge(x=importance_reg_rf_all,y=h2o.varimp(M_reg_rf_all)[c("variable","percentage")],by="variable")
      names(importance_reg_rf_all)[names(importance_reg_rf_all) == "percentage"] <- paste0("percentage",i)
            }
    
    #save model
    setwd("~/Model")
    saveRDS(M_reg_rf_all,paste0("M_reg_rf_all_",i,".rds"))    
  }

    (mse <- mean((as.vector(pred_reg_rf_all$Y)-as.vector(pred_reg_rf_all$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_rf_all$Y), as.vector(pred_reg_rf_all$predict)))))   

#plot
importance_reg_rf_all$mean <- apply(importance_reg_rf_all[,2:6], 1, mean)
importance_reg_rf_all$sd <- apply(importance_reg_rf_all[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_rf_all <-importance_reg_rf_all[c("variable","mean","sd")] 
P_importance_reg_rf_all<- P_importance_reg_rf_all[order(P_importance_reg_rf_all$mean,decreasing=TRUE),][1:20,]

plot_reg_rf_all <- ggplot(P_importance_reg_rf_all[order(P_importance_reg_rf_all$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="RF  Model for Poisson Regression
 (iRNA & Genomic & Regulator)", x="Feature (iRNA & Genomic & Regulator)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```
```{r}
#test
kpred_reg_rf_all<-pred_reg_rf_all  
kpred_reg_rf_all$predict<- kpred_reg_rf_all$predict/max(kpred_reg_rf_all$predict)
kpred_reg_rf_all$Y[which(kpred_reg_rf_all$Y>0)] <- 1

library(ROCR)
pred <- prediction(kpred_reg_rf_all$predict, kpred_reg_rf_all$Y)
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)
```
#reg_no_glm_irna25
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_irna_no0),5)

data <- Model_matrix_irna_no0
pred_reg_glm_irna_no0 <- data.frame()
importance_reg_glm_irna_no0<-data.frame()


  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
      M_reg_glm_irna_no0 <- h2o.glm(x = predictors_irna, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  family ="poisson",
                                                  seed = 1234)
                                     
    
    prediction <- h2o.predict(object = M_reg_glm_irna_no0, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_glm_irna_no0 <- rbind(pred_reg_glm_irna_no0,temp) 
    #feature importance
    
    if(i==1){
      importance_reg_glm_irna_no0 <- h2o.varimp(M_reg_glm_irna_no0)[c("variable","percentage")]
      names(importance_reg_glm_irna_no0)[names(importance_reg_glm_irna_no0) == "percentage"] <- "percentage1"
            }else{
      importance_reg_glm_irna_no0 <- merge(x=importance_reg_glm_irna_no0,y=h2o.varimp(M_reg_glm_irna_no0)[c("variable","percentage")],by="variable")
      names(importance_reg_glm_irna_no0)[names(importance_reg_glm_irna_no0) == "percentage"] <- paste0("percentage",i)
            }
    
    #save model
    setwd("~/Model")
    saveRDS(M_reg_glm_irna_no0,paste0("M_reg_glm_irna_no0_",i,".rds"))
  }
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_glm_irna_no0$Y), as.vector(pred_reg_glm_irna_no0$predict)))))
    (mse <- mean((as.vector(pred_reg_glm_irna_no0$Y)-as.vector(pred_reg_glm_irna_no0$predict))^2))
#plot
importance_reg_glm_irna_no0$mean <- apply(importance_reg_glm_irna_no0[,2:6], 1, mean)
importance_reg_glm_irna_no0$sd <- apply(importance_reg_glm_irna_no0[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_glm_irna_no0 <-importance_reg_glm_irna_no0[c("variable","mean","sd")] 
P_importance_reg_glm_irna_no0<- P_importance_reg_glm_irna_no0[order(P_importance_reg_glm_irna_no0$mean,decreasing=TRUE),][1:20,]

plot_reg_glm_irna_no0 <- ggplot(P_importance_reg_glm_irna_no0[order(P_importance_reg_glm_irna_no0$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="GLM  Model for Poisson Regression (without 0)", x="Feature (iRNA)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
    
```

#reg_no_dl_irna26
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_irna_no0),5)

data <- Model_matrix_irna_no0
pred_reg_dl_irna_no0 <- data.frame()
importance_reg_dl_irna_no0<-data.frame()


  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
      M_reg_dl_irna_no0 <- h2o.deeplearning(x = predictors_irna, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  hidden = c(1),
                                                  distribution = "poisson",                           
                                                  seed = 1234)
                                     
    
    prediction <- h2o.predict(object = M_reg_dl_irna_no0, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_dl_irna_no0 <- rbind(pred_reg_dl_irna_no0,temp) 
    #feature importance
    
    if(i==1){
      importance_reg_dl_irna_no0 <- h2o.varimp(M_reg_dl_irna_no0)[c("variable","percentage")]
      names(importance_reg_dl_irna_no0)[names(importance_reg_dl_irna_no0) == "percentage"] <- "percentage1"
            }else{
      importance_reg_dl_irna_no0 <- merge(x=importance_reg_dl_irna_no0,y=h2o.varimp(M_reg_dl_irna_no0)[c("variable","percentage")],by="variable")
      names(importance_reg_dl_irna_no0)[names(importance_reg_dl_irna_no0) == "percentage"] <- paste0("percentage",i)
            }
    
    #save model
    setwd("~/Model")
    saveRDS(M_reg_dl_irna_no0,paste0("M_reg_dl_irna_no0_",i,".rds"))
  }
    (mse <- mean((as.vector(pred_reg_dl_irna_no0$Y)-as.vector(pred_reg_dl_irna_no0$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_dl_irna_no0$Y), as.vector(pred_reg_dl_irna_no0$predict)))))
#plot
importance_reg_dl_irna_no0$mean <- apply(importance_reg_dl_irna_no0[,2:6], 1, mean)
importance_reg_dl_irna_no0$sd <- apply(importance_reg_dl_irna_no0[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_dl_irna_no0 <-importance_reg_dl_irna_no0[c("variable","mean","sd")] 
P_importance_reg_dl_irna_no0<- P_importance_reg_dl_irna_no0[order(P_importance_reg_dl_irna_no0$mean,decreasing=TRUE),][1:20,]

plot_reg_dl_irna_no0 <- ggplot(P_importance_reg_dl_irna_no0[order(P_importance_reg_dl_irna_no0$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="MLP  Model for Poisson Regression (without 0)", x="Feature (iRNA)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))

    
```
#reg_no_xgboost_irna27
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_irna_no0),5)

data <- Model_matrix_irna_no0
pred_reg_xgboost_irna_no0 <- data.frame()
importance_reg_xgboost_irna_no0<-data.frame()


  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
      M_reg_xgboost_irna_no0 <- h2o.xgboost(x = predictors_irna, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  learn_rate = 0.05,
                                                  gamma = 5,
                                                  max_depth = 5,
                                                  reg_alpha = 10,
                                                  reg_lambda = 10,
                                                  colsample_bytree = 0.3,
                                                  booster = "gbtree", 
                                                  normalize_type = "tree",
                                                  distribution = "poisson",
                                                  seed = 1234)
                                     
    
    prediction <- h2o.predict(object = M_reg_xgboost_irna_no0, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_xgboost_irna_no0 <- rbind(pred_reg_xgboost_irna_no0,temp) 
    #feature importance
    
    if(i==1){
      importance_reg_xgboost_irna_no0 <- h2o.varimp(M_reg_xgboost_irna_no0)[c("variable","percentage")]
      names(importance_reg_xgboost_irna_no0)[names(importance_reg_xgboost_irna_no0) == "percentage"] <- "percentage1"
            }else{
      importance_reg_xgboost_irna_no0 <- merge(x=importance_reg_xgboost_irna_no0,y=h2o.varimp(M_reg_xgboost_irna_no0)[c("variable","percentage")],by="variable")
      names(importance_reg_xgboost_irna_no0)[names(importance_reg_xgboost_irna_no0) == "percentage"] <- paste0("percentage",i)
            }
    
    #save model
    setwd("~/Model")
    saveRDS(M_reg_xgboost_irna_no0,paste0("M_reg_xgboost_irna_no0_",i,".rds"))    
  }

    (mse <- mean((as.vector(pred_reg_xgboost_irna_no0$Y)-as.vector(pred_reg_xgboost_irna_no0$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_xgboost_irna_no0$Y), as.vector(pred_reg_xgboost_irna_no0$predict))))) 

#plot
importance_reg_xgboost_irna_no0$mean <- apply(importance_reg_xgboost_irna_no0[,2:6], 1, mean)
importance_reg_xgboost_irna_no0$sd <- apply(importance_reg_xgboost_irna_no0[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_xgboost_irna_no0 <-importance_reg_xgboost_irna_no0[c("variable","mean","sd")] 
P_importance_reg_xgboost_irna_no0<- P_importance_reg_xgboost_irna_no0[order(P_importance_reg_xgboost_irna_no0$mean,decreasing=TRUE),][1:20,]

plot_reg_xgboost_irna_no0 <- ggplot(P_importance_reg_xgboost_irna_no0[order(P_importance_reg_xgboost_irna_no0$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="XGBoost Model for Poisson Regression (without 0)", x="Feature (iRNA)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```

#reg_no_rf_irna28
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_irna_no0),5)

data <- Model_matrix_irna_no0
pred_reg_rf_irna_no0 <- data.frame()   
importance_reg_rf_irna_no0<-data.frame()

  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
    M_reg_rf_irna_no0 <- h2o.randomForest(
                   x = predictors_irna,
                   y = "Y",
                   training_frame= as.h2o(train),
                   ntrees = 20,
                   max_depth = 10,
                    seed = 1234,
                   min_rows = 1
    )
                                     
    
    prediction <- h2o.predict(object = M_reg_rf_irna_no0, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_rf_irna_no0 <- rbind(pred_reg_rf_irna_no0,temp)
    
    #feature importance
    
    if(i==1){
      importance_reg_rf_irna_no0 <- h2o.varimp(M_reg_rf_irna_no0)[c("variable","percentage")]
      names(importance_reg_rf_irna_no0)[names(importance_reg_rf_irna_no0) == "percentage"] <- "percentage1"
            }else{
      importance_reg_rf_irna_no0 <- merge(x=importance_reg_rf_irna_no0,y=h2o.varimp(M_reg_rf_irna_no0)[c("variable","percentage")],by="variable")
      names(importance_reg_rf_irna_no0)[names(importance_reg_rf_irna_no0) == "percentage"] <- paste0("percentage",i)
            }
    
    #save model
    setwd("~/Model")
    saveRDS(M_reg_rf_irna_no0,paste0("M_reg_rf_irna_no0_",i,".rds"))    
  }

    (mse <- mean((as.vector(pred_reg_rf_irna_no0$Y)-as.vector(pred_reg_rf_irna_no0$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_rf_irna_no0$Y), as.vector(pred_reg_rf_irna_no0$predict)))))   

#plot
importance_reg_rf_irna_no0$mean <- apply(importance_reg_rf_irna_no0[,2:6], 1, mean)
importance_reg_rf_irna_no0$sd <- apply(importance_reg_rf_irna_no0[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_rf_irna_no0 <-importance_reg_rf_irna_no0[c("variable","mean","sd")] 
P_importance_reg_rf_irna_no0<- P_importance_reg_rf_irna_no0[order(P_importance_reg_rf_irna_no0$mean,decreasing=TRUE),][1:20,]

plot_reg_rf_irna_no0 <- ggplot(P_importance_reg_rf_irna_no0[order(P_importance_reg_rf_irna_no0$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="RF  Model for Poisson Regression (without 0)", x="Feature (iRNA)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```

#reg_no_glm_irna_whistle29
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_irna_whistle_no0),5)

data <- Model_matrix_irna_whistle_no0
pred_reg_glm_irna_whistle_no0 <- data.frame() 
importance_reg_glm_irna_whistle_no0<-data.frame()


  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
      M_reg_glm_irna_whistle_no0 <- h2o.glm(x = predictors_irna_whistle, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  family ="poisson",
                                                  seed = 1234)
                                     
    
    prediction <- h2o.predict(object = M_reg_glm_irna_whistle_no0, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_glm_irna_whistle_no0 <- rbind(pred_reg_glm_irna_whistle_no0,temp)
    
    #feature importance
    
    if(i==1){
      importance_reg_glm_irna_whistle_no0 <- h2o.varimp(M_reg_glm_irna_whistle_no0)[c("variable","percentage")]
      names(importance_reg_glm_irna_whistle_no0)[names(importance_reg_glm_irna_whistle_no0) == "percentage"] <- "percentage1"
            }else{
      importance_reg_glm_irna_whistle_no0 <- merge(x=importance_reg_glm_irna_whistle_no0,y=h2o.varimp(M_reg_glm_irna_whistle_no0)[c("variable","percentage")],by="variable")
      names(importance_reg_glm_irna_whistle_no0)[names(importance_reg_glm_irna_whistle_no0) == "percentage"] <- paste0("percentage",i)
            }
    
    #save model
    setwd("~/Model")
    saveRDS(M_reg_glm_irna_whistle_no0,paste0("M_reg_glm_irna_whistle_no0_",i,".rds"))
  }

    (mse <- mean((as.vector(pred_reg_glm_irna_whistle_no0$Y)-as.vector(pred_reg_glm_irna_whistle_no0$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_glm_irna_whistle_no0$Y), as.vector(pred_reg_glm_irna_whistle_no0$predict)))))
#plot
importance_reg_glm_irna_whistle_no0$mean <- apply(importance_reg_glm_irna_whistle_no0[,2:6], 1, mean)
importance_reg_glm_irna_whistle_no0$sd <- apply(importance_reg_glm_irna_whistle_no0[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_glm_irna_whistle_no0 <-importance_reg_glm_irna_whistle_no0[c("variable","mean","sd")] 
P_importance_reg_glm_irna_whistle_no0<- P_importance_reg_glm_irna_whistle_no0[order(P_importance_reg_glm_irna_whistle_no0$mean,decreasing=TRUE),][1:20,]

plot_reg_glm_irna_whistle_no0 <- ggplot(P_importance_reg_glm_irna_whistle_no0[order(P_importance_reg_glm_irna_whistle_no0$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="GLM  Model for Poisson Regression (without 0)", x="Feature (iRNA & Genomic)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```

#reg_no_dl_irna_whistle30
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_irna_whistle_no0),5)

data <- Model_matrix_irna_whistle_no0
pred_reg_dl_irna_whistle_no0 <- data.frame()
importance_reg_dl_irna_whistle_no0<-data.frame()


  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
      M_reg_dl_irna_whistle_no0 <- h2o.deeplearning(x = predictors_irna_whistle, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  hidden = c(1),
                                                  distribution = "poisson",  
                                                 # adaptive_rate=F,                ## manually tuned learning rate
                                                 # rate=0.01, 
                                                  rate_annealing=2e-6,
                                                  seed = 1234)
                                     
    
    prediction <- h2o.predict(object = M_reg_dl_irna_whistle_no0, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_dl_irna_whistle_no0 <- rbind(pred_reg_dl_irna_whistle_no0,temp) 
    #feature importance
    
    if(i==1){
      importance_reg_dl_irna_whistle_no0 <- h2o.varimp(M_reg_dl_irna_whistle_no0)[c("variable","percentage")]
      names(importance_reg_dl_irna_whistle_no0)[names(importance_reg_dl_irna_whistle_no0) == "percentage"] <- "percentage1"
            }else{
      importance_reg_dl_irna_whistle_no0 <- merge(x=importance_reg_dl_irna_whistle_no0,y=h2o.varimp(M_reg_dl_irna_whistle_no0)[c("variable","percentage")],by="variable")
      names(importance_reg_dl_irna_whistle_no0)[names(importance_reg_dl_irna_whistle_no0) == "percentage"] <- paste0("percentage",i)
            }
    
    #save model
    setwd("~/Model")
    saveRDS(M_reg_dl_irna_whistle_no0,paste0("M_reg_dl_irna_whistle_no0_",i,".rds"))
  }
    (mse <- mean((as.vector(pred_reg_dl_irna_whistle_no0$Y)-as.vector(pred_reg_dl_irna_whistle_no0$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_dl_irna_whistle_no0$Y), as.vector(pred_reg_dl_irna_whistle_no0$predict)))))
#plot
importance_reg_dl_irna_whistle_no0$mean <- apply(importance_reg_dl_irna_whistle_no0[,2:6], 1, mean)
importance_reg_dl_irna_whistle_no0$sd <- apply(importance_reg_dl_irna_whistle_no0[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_dl_irna_whistle_no0 <-importance_reg_dl_irna_whistle_no0[c("variable","mean","sd")] 
P_importance_reg_dl_irna_whistle_no0<- P_importance_reg_dl_irna_whistle_no0[order(P_importance_reg_dl_irna_whistle_no0$mean,decreasing=TRUE),][1:20,]

plot_reg_dl_irna_whistle_no0 <- ggplot(P_importance_reg_dl_irna_whistle_no0[order(P_importance_reg_dl_irna_whistle_no0$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="MLP  Model for Poisson Regression (without 0)
", x="Feature (iRNA & Genomic)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))

```
#reg_no_xgboost_irna_whistle31
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_irna_whistle_no0),5)

data <- Model_matrix_irna_whistle_no0
pred_reg_xgboost_irna_whistle_no0 <- data.frame() 
importance_reg_xgboost_irna_whistle_no0<-data.frame()


  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
      M_reg_xgboost_irna_whistle_no0 <- h2o.xgboost(x = predictors_irna_whistle, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  learn_rate = 0.05,
                                                  gamma = 5,
                                                  max_depth = 5,
                                                  reg_alpha = 10,
                                                  reg_lambda = 10,
                                                  colsample_bytree = 0.3,
                                                  booster = "gbtree", 
                                                  normalize_type = "tree",
                                                  distribution = "poisson",
                                                  seed = 1234)
                                     
    
    prediction <- h2o.predict(object = M_reg_xgboost_irna_whistle_no0, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_xgboost_irna_whistle_no0 <- rbind(pred_reg_xgboost_irna_whistle_no0,temp)
    #feature importance
    
    if(i==1){
      importance_reg_xgboost_irna_whistle_no0 <- h2o.varimp(M_reg_xgboost_irna_whistle_no0)[c("variable","percentage")]
      names(importance_reg_xgboost_irna_whistle_no0)[names(importance_reg_xgboost_irna_whistle_no0) == "percentage"] <- "percentage1"
            }else{
      importance_reg_xgboost_irna_whistle_no0 <- merge(x=importance_reg_xgboost_irna_whistle_no0,y=h2o.varimp(M_reg_xgboost_irna_whistle_no0)[c("variable","percentage")],by="variable")
      names(importance_reg_xgboost_irna_whistle_no0)[names(importance_reg_xgboost_irna_whistle_no0) == "percentage"] <- paste0("percentage",i)
            }
    #save model
    setwd("~/Model")
    saveRDS(M_reg_xgboost_irna_whistle_no0,paste0("M_reg_xgboost_irna_whistle_no0_",i,".rds"))
  }

    (mse <- mean((as.vector(pred_reg_xgboost_irna_whistle_no0$Y)-as.vector(pred_reg_xgboost_irna_whistle_no0$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_xgboost_irna_whistle_no0$Y), as.vector(pred_reg_xgboost_irna_whistle_no0$predict)))))
#plot
importance_reg_xgboost_irna_whistle_no0$mean <- apply(importance_reg_xgboost_irna_whistle_no0[,2:6], 1, mean)
importance_reg_xgboost_irna_whistle_no0$sd <- apply(importance_reg_xgboost_irna_whistle_no0[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_xgboost_irna_whistle_no0 <-importance_reg_xgboost_irna_whistle_no0[c("variable","mean","sd")] 
P_importance_reg_xgboost_irna_whistle_no0<- P_importance_reg_xgboost_irna_whistle_no0[order(P_importance_reg_xgboost_irna_whistle_no0$mean,decreasing=TRUE),][1:20,]

plot_reg_xgboost_irna_whistle_no0 <- ggplot(P_importance_reg_xgboost_irna_whistle_no0[order(P_importance_reg_xgboost_irna_whistle_no0$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="XGBoost Model for Poisson Regression (without 0)
", x="Feature (iRNA & Genomic)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```
#reg_no_rf_irna_whistle32
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_irna_whistle_no0),5)

data <- Model_matrix_irna_whistle_no0
pred_reg_rf_irna_whistle_no0 <- data.frame()   
importance_reg_rf_irna_whistle_no0<-data.frame()

  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
    M_reg_rf_irna_whistle_no0 <- h2o.randomForest(
                   x = predictors_irna_whistle,
                   y = "Y",
                   training_frame= as.h2o(train),
                   ntrees = 20,
                   max_depth = 10,
                    seed = 1234,
                   min_rows = 1
    )
                                     
    
    prediction <- h2o.predict(object = M_reg_rf_irna_whistle_no0, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_rf_irna_whistle_no0 <- rbind(pred_reg_rf_irna_whistle_no0,temp)
    
    #feature importance
    
    if(i==1){
      importance_reg_rf_irna_whistle_no0 <- h2o.varimp(M_reg_rf_irna_whistle_no0)[c("variable","percentage")]
      names(importance_reg_rf_irna_whistle_no0)[names(importance_reg_rf_irna_whistle_no0) == "percentage"] <- "percentage1"
            }else{
      importance_reg_rf_irna_whistle_no0 <- merge(x=importance_reg_rf_irna_whistle_no0,y=h2o.varimp(M_reg_rf_irna_whistle_no0)[c("variable","percentage")],by="variable")
      names(importance_reg_rf_irna_whistle_no0)[names(importance_reg_rf_irna_whistle_no0) == "percentage"] <- paste0("percentage",i)
            }
    
    #save model
    setwd("~/Model")
    saveRDS(M_reg_rf_irna_whistle_no0,paste0("M_reg_rf_irna_no0_",i,".rds"))    
  }

    (mse <- mean((as.vector(pred_reg_rf_irna_whistle_no0$Y)-as.vector(pred_reg_rf_irna_whistle_no0$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_rf_irna_whistle_no0$Y), as.vector(pred_reg_rf_irna_whistle_no0$predict)))))   

#plot
importance_reg_rf_irna_whistle_no0$mean <- apply(importance_reg_rf_irna_whistle_no0[,2:6], 1, mean)
importance_reg_rf_irna_whistle_no0$sd <- apply(importance_reg_rf_irna_whistle_no0[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_rf_irna_whistle_no0 <-importance_reg_rf_irna_whistle_no0[c("variable","mean","sd")] 
P_importance_reg_rf_irna_whistle_no0<- P_importance_reg_rf_irna_whistle_no0[order(P_importance_reg_rf_irna_whistle_no0$mean,decreasing=TRUE),][1:20,]

plot_reg_rf_irna_whistle_no0 <- ggplot(P_importance_reg_rf_irna_whistle_no0[order(P_importance_reg_rf_irna_whistle_no0$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="RF  Model for Poisson Regression (without 0)
", x="Feature (iRNA & Genomic)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```


#reg_no_glm_all33
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_all_no0),5)

data <- Model_matrix_all_no0
pred_reg_glm_all_no0 <- data.frame()
importance_reg_glm_all_no0<-data.frame()


  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
      M_reg_glm_all_no0 <- h2o.glm(x = predictors_all, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  family ="poisson",
                                                  seed = 1234)
                                     
    
    prediction <- h2o.predict(object = M_reg_glm_all_no0, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_glm_all_no0 <- rbind(pred_reg_glm_all_no0,temp)
    
    #feature importance
    
    if(i==1){
      importance_reg_glm_all_no0 <- h2o.varimp(M_reg_glm_all_no0)[c("variable","percentage")]
      names(importance_reg_glm_all_no0)[names(importance_reg_glm_all_no0) == "percentage"] <- "percentage1"
            }else{
      importance_reg_glm_all_no0 <- merge(x=importance_reg_glm_all_no0,y=h2o.varimp(M_reg_glm_all_no0)[c("variable","percentage")],by="variable")
      names(importance_reg_glm_all_no0)[names(importance_reg_glm_all_no0) == "percentage"] <- paste0("percentage",i)
            }
    
    #save model
    setwd("~/Model")
    saveRDS(M_reg_glm_all_no0,paste0("M_reg_glm_all_no0_",i,".rds"))
  }

    (mse <- mean((as.vector(pred_reg_glm_all_no0$Y)-as.vector(pred_reg_glm_all_no0$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_glm_all_no0$Y), as.vector(pred_reg_glm_all_no0$predict)))))
#plot
importance_reg_glm_all_no0$mean <- apply(importance_reg_glm_all_no0[,2:6], 1, mean)
importance_reg_glm_all_no0$sd <- apply(importance_reg_glm_all_no0[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_glm_all_no0 <-importance_reg_glm_all_no0[c("variable","mean","sd")] 
P_importance_reg_glm_all_no0<- P_importance_reg_glm_all_no0[order(P_importance_reg_glm_all_no0$mean,decreasing=TRUE),][1:20,]

plot_reg_glm_all_no0 <- ggplot(P_importance_reg_glm_all_no0[order(P_importance_reg_glm_all_no0$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="GLM  Model for Poisson Regression (without 0)", x="Feature (iRNA & Genomic & Regulator)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```
#reg_no_dl_all34
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_all_no0),5)

data <- Model_matrix_all_no0
pred_reg_dl_all_no0 <- data.frame()
importance_reg_dl_all_no0<-data.frame()


  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
      M_reg_dl_all_no0 <- h2o.deeplearning(x = predictors_all, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  hidden = c(1),
                                                  distribution = "poisson",                           
                                                  seed = 1234)
                                     
    
    prediction <- h2o.predict(object = M_reg_dl_all_no0, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_dl_all_no0 <- rbind(pred_reg_dl_all_no0,temp)
    
     #feature importance
    
    if(i==1){
      importance_reg_dl_all_no0 <- h2o.varimp(M_reg_dl_all_no0)[c("variable","percentage")]
      names(importance_reg_dl_all_no0)[names(importance_reg_dl_all_no0) == "percentage"] <- "percentage1"
            }else{
      importance_reg_dl_all_no0 <- merge(x=importance_reg_dl_all_no0,y=h2o.varimp(M_reg_dl_all_no0)[c("variable","percentage")],by="variable")
      names(importance_reg_dl_all_no0)[names(importance_reg_dl_all_no0) == "percentage"] <- paste0("percentage",i)
            }
    
    #save model
    setwd("~/Model")
    saveRDS(M_reg_dl_all_no0,paste0("M_reg_dl_all_no0_",i,".rds"))
  }
    (mse <- mean((as.vector(pred_reg_dl_all_no0$Y)-as.vector(pred_reg_dl_all_no0$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_dl_all_no0$Y), as.vector(pred_reg_dl_all_no0$predict)))))
#plot
importance_reg_dl_all_no0$mean <- apply(importance_reg_dl_all_no0[,2:6], 1, mean)
importance_reg_dl_all_no0$sd <- apply(importance_reg_dl_all_no0[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_dl_all_no0 <-importance_reg_dl_all_no0[c("variable","mean","sd")] 
P_importance_reg_dl_all_no0<- P_importance_reg_dl_all_no0[order(P_importance_reg_dl_all_no0$mean,decreasing=TRUE),][1:20,]

plot_reg_dl_all_no0 <- ggplot(P_importance_reg_dl_all_no0[order(P_importance_reg_dl_all_no0$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="MLP  Model for Poisson Regression (without 0)", x="Feature (iRNA & Genomic & Regulator)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))

    
```
#reg_no_xgboost_all35
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_all_no0),5)

data <- Model_matrix_all_no0
pred_reg_xgboost_all_no0 <- data.frame()
importance_reg_xgboost_all_no0<-data.frame()


  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
      M_reg_xgboost_all_no0 <- h2o.xgboost(x = predictors_all, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  learn_rate = 0.05,
                                                  gamma = 5,
                                                  max_depth = 5,
                                                  reg_alpha = 10,
                                                  reg_lambda = 10,
                                                  colsample_bytree = 0.3,
                                                  booster = "gbtree", 
                                                  normalize_type = "tree",
                                                  distribution = "poisson",
                                                  seed = 1234)
                                     
    
    prediction <- h2o.predict(object = M_reg_xgboost_all_no0, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_xgboost_all_no0 <- rbind(pred_reg_xgboost_all_no0,temp) 
    
    #feature importance
    
    if(i==1){
      importance_reg_xgboost_all_no0 <- h2o.varimp(M_reg_xgboost_all_no0)[c("variable","percentage")]
      names(importance_reg_xgboost_all_no0)[names(importance_reg_xgboost_all_no0) == "percentage"] <- "percentage1"
            }else{
      importance_reg_xgboost_all_no0 <- merge(x=importance_reg_xgboost_all_no0,y=h2o.varimp(M_reg_xgboost_all_no0)[c("variable","percentage")],by="variable")
      names(importance_reg_xgboost_all_no0)[names(importance_reg_xgboost_all_no0) == "percentage"] <- paste0("percentage",i)
            }
    
    #save model
    setwd("~/Model")
    saveRDS(M_reg_xgboost_all_no0,paste0("M_reg_xgboost_all_no0_",i,".rds"))
  }

    (mse <- mean((as.vector(pred_reg_xgboost_all_no0$Y)-as.vector(pred_reg_xgboost_all_no0$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_xgboost_all_no0$Y), as.vector(pred_reg_xgboost_all_no0$predict))))) 
#plot
importance_reg_xgboost_all_no0$mean <- apply(importance_reg_xgboost_all_no0[,2:6], 1, mean)
importance_reg_xgboost_all_no0$sd <- apply(importance_reg_xgboost_all_no0[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_xgboost_all_no0 <-importance_reg_xgboost_all_no0[c("variable","mean","sd")] 
P_importance_reg_xgboost_all_no0<- P_importance_reg_xgboost_all_no0[order(P_importance_reg_xgboost_all_no0$mean,decreasing=TRUE),][1:20,]

plot_reg_xgboost_all_no0 <- ggplot(P_importance_reg_xgboost_all_no0[order(P_importance_reg_xgboost_all_no0$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="XGBoost Model for Poisson Regression (without 0)
", x="Feature (iRNA & Genomic & Regulator)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```
#reg_no_rf_all36
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_all_no0),5)

data <- Model_matrix_all_no0
pred_reg_rf_all_no0 <- data.frame()   
importance_reg_rf_all_no0<-data.frame()

  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
    M_reg_rf_all_no0 <- h2o.randomForest(
                   x = predictors_all,
                   y = "Y",
                   training_frame= as.h2o(train),
                   ntrees = 20,
                   max_depth = 10,
                    seed = 1234,
                   min_rows = 1
    )
                                     
    
    prediction <- h2o.predict(object = M_reg_rf_all_no0, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_rf_all_no0 <- rbind(pred_reg_rf_all_no0,temp)
    
    #feature importance
    
    if(i==1){
      importance_reg_rf_all_no0 <- h2o.varimp(M_reg_rf_all_no0)[c("variable","percentage")]
      names(importance_reg_rf_all_no0)[names(importance_reg_rf_all_no0) == "percentage"] <- "percentage1"
            }else{
      importance_reg_rf_all_no0 <- merge(x=importance_reg_rf_all_no0,y=h2o.varimp(M_reg_rf_all_no0)[c("variable","percentage")],by="variable")
      names(importance_reg_rf_all_no0)[names(importance_reg_rf_all_no0) == "percentage"] <- paste0("percentage",i)
            }
    
    #save model
    setwd("~/Model")
    saveRDS(M_reg_rf_all_no0,paste0("M_reg_rf_all_no0_",i,".rds"))    
  }

    (mse <- mean((as.vector(pred_reg_rf_all_no0$Y)-as.vector(pred_reg_rf_all_no0$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_rf_all_no0$Y), as.vector(pred_reg_rf_all_no0$predict)))))   

#plot
importance_reg_rf_all_no0$mean <- apply(importance_reg_rf_all_no0[,2:6], 1, mean)
importance_reg_rf_all_no0$sd <- apply(importance_reg_rf_all_no0[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_rf_all_no0 <-importance_reg_rf_all_no0[c("variable","mean","sd")] 
P_importance_reg_rf_all_no0<- P_importance_reg_rf_all_no0[order(P_importance_reg_rf_all_no0$mean,decreasing=TRUE),][1:20,]

plot_reg_rf_all_no0 <- ggplot(P_importance_reg_rf_all_no0[order(P_importance_reg_rf_all_no0$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="XGBoost Model for Poisson Regression (without 0)", x="Feature (iRNA & Genomic & Regulator)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))

```

#cla_glm_irna_Rulators37
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_irna_whistle),5)

#preperation
data <- Model_matrix_irna_regulators
pred_cla_glm_irna_regulators <- data.frame()   
aba_cla_glm_irna_regulators <- data.frame()
prediciton <-data.frame()
importance_cla_glm_irna_regulators<-data.frame()

#5-fold
  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
    #Store corresponding count(authenticated)
    aba_cla_glm_irna_regulators <- rbind(aba_cla_glm_irna_regulators,subset(as.data.frame(test),select =Yor))
      #model
      M_cla_glm_irna_regulators<- h2o.glm(x = predictors_irna_regulators, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  seed = 123)
                                     
    #prediction--generate p1
    prediction <- h2o.predict(object = M_cla_glm_irna_regulators, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_cla_glm_irna_regulators <- rbind(pred_cla_glm_irna_regulators,temp)  
    #feature importance
    if(i==1){
      importance_cla_glm_irna_regulators <- h2o.varimp(M_cla_glm_irna_regulators)[c("variable","percentage")]
      names(importance_cla_glm_irna_regulators)[names(importance_cla_glm_irna_regulators) == "percentage"] <- "percentage1"
            }else{
      importance_cla_glm_irna_regulators <- merge(x=importance_cla_glm_irna_regulators,y=h2o.varimp(M_cla_glm_irna_regulators)[c("variable","percentage")],by="variable")
      names(importance_cla_glm_irna_regulators)[names(importance_cla_glm_irna_regulators) == "percentage"] <- paste0("percentage",i)
                  }
    #save model
    setwd("~/Model")
    saveRDS(M_cla_glm_irna_regulators,paste0("M_cla_glm_irna_regulators_",i,".rds"))
  }

#for table1--auc mcc
library(ROCR)
pred <- prediction(as.numeric(pred_cla_glm_irna_regulators$p1), as.numeric(pred_cla_glm_irna_regulators$Y))
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)

#for table3
print("-------------------------------table3")
prediciton_cla_glm_irna_regulators3<-data.frame()
prediciton_cla_glm_irna_regulators3<- cbind(as.data.frame(pred_cla_glm_irna_regulators$p1),as.data.frame(aba_cla_glm_irna_regulators$Yor))
names(prediciton_cla_glm_irna_regulators3)[names(prediciton_cla_glm_irna_regulators3) == 'aba_cla_glm_irna_regulators$Yor'] <- 'Yor'
names(prediciton_cla_glm_irna_regulators3)[names(prediciton_cla_glm_irna_regulators3) == 'pred_cla_glm_irna_regulators$p1'] <- 'p1'

(mse <- mean((as.vector(as.numeric(prediciton_cla_glm_irna_regulators3$Yor))-as.vector(40*prediciton_cla_glm_irna_regulators3$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_glm_irna_regulators3$Yor)), as.vector(40*prediciton_cla_glm_irna_regulators3$p1)))))

#plot
importance_cla_glm_irna_regulators$mean <- apply(importance_cla_glm_irna_regulators[,2:6], 1, mean)
importance_cla_glm_irna_regulators$sd <- apply(importance_cla_glm_irna_regulators[,2:6], 1, sd)
library(ggplot2)
P_importance_cla_glm_irna_regulators <-importance_cla_glm_irna_regulators[c("variable","mean","sd")] 
P_importance_cla_glm_irna_regulators<- P_importance_cla_glm_irna_regulators[order(P_importance_cla_glm_irna_whistle$mean,decreasing=TRUE),][1:20,]

plot_cla_glm_irna_regulators <- ggplot(P_importance_cla_glm_irna_regulators[order(P_importance_cla_glm_irna_regulators$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="GLM  Model for Classification (iRNA & Regulator)", x="Feature (iRNA & Regulator)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```

```{r}
#table5
w<- which(prediciton_cla_glm_irna_regulators3$Yor==0)
prediciton_cla_glm_irna_regulators5<- prediciton_cla_glm_irna_regulators3[-w,]

(mse <- mean((as.vector(as.numeric(prediciton_cla_glm_irna_regulators5$Yor))-as.vector(40*prediciton_cla_glm_irna_regulators5$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_glm_irna_regulators5$Yor)), as.vector(40*prediciton_cla_glm_irna_regulators5$p1)))))

```

```{r}
#table6
prediciton_cla_glm_irna_regulators6 <- prediciton_cla_glm_irna_regulators5
prediciton_cla_glm_irna_regulators6$pred <- pmax( round( (prediciton_cla_glm_irna_regulators5$p1*40) - mean(prediciton_cla_glm_irna_regulators5$p1*40) + mean_ycount_on_training), 1)

(mse <- mean((as.vector(as.numeric(prediciton_cla_glm_irna_regulators6$Yor))-as.vector(prediciton_cla_glm_irna_regulators6$pred))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_glm_irna_regulators6$Yor)), as.vector(prediciton_cla_glm_irna_regulators6$pred)))))
```
#cla_dl_irna_regulators38
```{r}

 library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_irna_regulators),5)

#preperation
data <- Model_matrix_irna_regulators
pred_cla_dl_irna_regulators <- data.frame()   
aba_cla_dl_irna_regulators <- data.frame()
prediciton <-data.frame()
importance_cla_dl_irna_regulators<-data.frame()

#5-fold
  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
    #Store corresponding count(authenticated)
    aba_cla_dl_irna_regulators <- rbind(aba_cla_dl_irna_regulators,subset(as.data.frame(test),select =Yor))
      #model
      M_cla_dl_irna_regulators<- h2o.deeplearning(x = predictors_irna_regulators, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  hidden = c(1),
                                                  seed = 1234)
    #prediction--generate p1
    prediction <- h2o.predict(object = M_cla_dl_irna_regulators, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_cla_dl_irna_regulators <- rbind(pred_cla_dl_irna_regulators,temp)  
    #feature importance
    if(i==1){
      importance_cla_dl_irna_regulators <- h2o.varimp(M_cla_dl_irna_regulators)[c("variable","percentage")]
      names(importance_cla_dl_irna_regulators)[names(importance_cla_dl_irna_regulators) == "percentage"] <- "percentage1"
            }else{
      importance_cla_dl_irna_regulators <- merge(x=importance_cla_dl_irna_regulators,y=h2o.varimp(M_cla_dl_irna_regulators)[c("variable","percentage")],by="variable")
      names(importance_cla_dl_irna_regulators)[names(importance_cla_dl_irna_regulators) == "percentage"] <- paste0("percentage",i)
                  }
    #save model
    setwd("~/Model")
    saveRDS(M_cla_dl_irna_regulators,paste0("M_cla_dl_irna_regulators_",i,".rds"))
  }

#for table1--auc mcc
library(ROCR)
pred <- prediction(as.numeric(pred_cla_dl_irna_regulators$p1), as.numeric(pred_cla_dl_irna_regulators$Y))
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)

#for table3
print("-------------------------------table3")
prediciton_cla_dl_irna_regulators3<-data.frame()
prediciton_cla_dl_irna_regulators3<- cbind(as.data.frame(pred_cla_dl_irna_regulators$p1),as.data.frame(aba_cla_dl_irna_regulators$Yor))
names(prediciton_cla_dl_irna_regulators3)[names(prediciton_cla_dl_irna_regulators3) == 'aba_cla_dl_irna_regulators$Yor'] <- 'Yor'
names(prediciton_cla_dl_irna_regulators3)[names(prediciton_cla_dl_irna_regulators3) == 'pred_cla_dl_irna_regulators$p1'] <- 'p1'

(mse <- mean((as.vector(as.numeric(prediciton_cla_dl_irna_regulators3$Yor))-as.vector(40*prediciton_cla_dl_irna_regulators3$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_dl_irna_regulators3$Yor)), as.vector(40*prediciton_cla_dl_irna_regulators3$p1)))))

#plot
importance_cla_dl_irna_regulators$mean <- apply(importance_cla_dl_irna_regulators[,2:6], 1, mean)
importance_cla_dl_irna_regulators$sd <- apply(importance_cla_dl_irna_regulators[,2:6], 1, sd)
library(ggplot2)
P_importance_cla_dl_irna_regulators <-importance_cla_dl_irna_regulators[c("variable","mean","sd")] 
P_importance_cla_dl_irna_regulators<- P_importance_cla_dl_irna_regulators[order(P_importance_cla_dl_irna_regulators$mean,decreasing=TRUE),][1:20,]

plot_cla_dl_irna_regulators <- ggplot(P_importance_cla_dl_irna_regulators[order(P_importance_cla_dl_irna_regulators$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="MLP  Model for Classification (iRNA & Regulator)", x="Feature (iRNA & Regulator)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))                                    
    
```

```{r}
#table5
w<- which(prediciton_cla_dl_irna_regulators3$Yor==0)
prediciton_cla_dl_irna_regulators5<- prediciton_cla_dl_irna_regulators3[-w,]

(mse <- mean((as.vector(as.numeric(prediciton_cla_dl_irna_regulators5$Yor))-as.vector(40*prediciton_cla_dl_irna_regulators5$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_dl_irna_regulators5$Yor)), as.vector(40*prediciton_cla_dl_irna_regulators5$p1)))))

```

```{r}
#table6
prediciton_cla_dl_irna_regulators6 <- prediciton_cla_dl_irna_regulators5
prediciton_cla_dl_irna_regulators6$pred <- pmax( round( (prediciton_cla_dl_irna_regulators5$p1*40) - mean(prediciton_cla_dl_irna_regulators5$p1*40) + mean_ycount_on_training), 1)

(mse <- mean((as.vector(as.numeric(prediciton_cla_dl_irna_regulators6$Yor))-as.vector(prediciton_cla_dl_irna_regulators6$pred))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_dl_irna_regulators6$Yor)), as.vector(prediciton_cla_dl_irna_regulators6$pred)))))
```
#cla_xgboost_irna_regulators39
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_irna_regulators),5)

#preperation
data <- Model_matrix_irna_regulators
pred_cla_xgboost_irna_regulators <- data.frame()   
aba_cla_xgboost_irna_regulators <- data.frame()
prediciton <-data.frame()
importance_cla_xgboost_irna_regulators<-data.frame()

#5-fold
  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
    #Store corresponding count(authenticated)
    aba_cla_xgboost_irna_regulators <- rbind(aba_cla_xgboost_irna_regulators,subset(as.data.frame(test),select =Yor))
      #model
      M_cla_xgboost_irna_regulators <- h2o.xgboost(x = predictors_irna_regulators, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  learn_rate = 0.05,
                                                  gamma = 5,
                                                  max_depth = 5,
                                                  reg_alpha = 10,
                                                  reg_lambda = 10,
                                                  colsample_bytree = 0.3,
                                                  booster = "gbtree", 
                                                  normalize_type = "tree",
                                                  seed = 1234)
                                     
                                     
    #prediction--generate p1
    prediction <- h2o.predict(object = M_cla_xgboost_irna_regulators, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_cla_xgboost_irna_regulators <- rbind(pred_cla_xgboost_irna_regulators,temp)  
    #feature importance
    if(i==1){
      importance_cla_xgboost_irna_regulators <- h2o.varimp(M_cla_xgboost_irna_regulators)[c("variable","percentage")]
      names(importance_cla_xgboost_irna_regulators)[names(importance_cla_xgboost_irna_regulators) == "percentage"] <- "percentage1"
            }else{
      importance_cla_xgboost_irna_regulators <- merge(x=importance_cla_xgboost_irna_regulators,y=h2o.varimp(M_cla_xgboost_irna_regulators)[c("variable","percentage")],by="variable")
      names(importance_cla_xgboost_irna_regulators)[names(importance_cla_xgboost_irna_regulators) == "percentage"] <- paste0("percentage",i)
                  }
    #save model
    setwd("~/Model")
    saveRDS(M_cla_xgboost_irna_regulators,paste0("M_cla_xgboost_irna_regulators_",i,".rds"))
  }

#for table1--auc mcc
library(ROCR)
pred <- prediction(as.numeric(pred_cla_xgboost_irna_regulators$p1), as.numeric(pred_cla_xgboost_irna_regulators$Y))
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)

#for table3
print("-------------------------------table3")
prediciton_cla_xgboost_irna_regulators3<-data.frame()
prediciton_cla_xgboost_irna_regulators3<- cbind(as.data.frame(pred_cla_xgboost_irna_regulators$p1),as.data.frame(aba_cla_xgboost_irna_regulators$Yor))
names(prediciton_cla_xgboost_irna_regulators3)[names(prediciton_cla_xgboost_irna_regulators3) == 'aba_cla_xgboost_irna_regulators$Yor'] <- 'Yor'
names(prediciton_cla_xgboost_irna_regulators3)[names(prediciton_cla_xgboost_irna_regulators3) == 'pred_cla_xgboost_irna_regulators$p1'] <- 'p1'

(mse <- mean((as.vector(as.numeric(prediciton_cla_xgboost_irna_regulators3$Yor))-as.vector(40*prediciton_cla_xgboost_irna_regulators3$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_xgboost_irna_regulators3$Yor)), as.vector(40*prediciton_cla_xgboost_irna_regulators3$p1)))))

#plot
importance_cla_xgboost_irna_regulators$mean <- apply(importance_cla_xgboost_irna_regulators[,2:6], 1, mean)
importance_cla_xgboost_irna_regulators$sd <- apply(importance_cla_xgboost_irna_regulators[,2:6], 1, sd)
library(ggplot2)
P_importance_cla_xgboost_irna_regulators <-importance_cla_xgboost_irna_regulators[c("variable","mean","sd")] 
P_importance_cla_xgboost_irna_regulators<- P_importance_cla_xgboost_irna_regulators[order(P_importance_cla_xgboost_irna_regulators$mean,decreasing=TRUE),][1:20,]

plot_cla_xgboost_irna_regulators <- ggplot(P_importance_cla_xgboost_irna_regulators[order(P_importance_cla_xgboost_irna_regulators$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="XGBoost Model for Classification (iRNA & Regulator)", x="Feature (iRNA & Regulator)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```

```{r}
#table5
w<- which(prediciton_cla_xgboost_irna_regulators3$Yor==0)
prediciton_cla_xgboost_irna_regulators5<- prediciton_cla_xgboost_irna_regulators3[-w,]

(mse <- mean((as.vector(as.numeric(prediciton_cla_xgboost_irna_regulators5$Yor))-as.vector(40*prediciton_cla_xgboost_irna_regulators5$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_xgboost_irna_regulators5$Yor)), as.vector(40*prediciton_cla_xgboost_irna_regulators5$p1)))))

```

```{r}
#table6
prediciton_cla_xgboost_irna_regulators6 <- prediciton_cla_xgboost_irna_regulators5
prediciton_cla_xgboost_irna_regulators6$pred <- pmax( round( (prediciton_cla_xgboost_irna_regulators6$p1*40) - mean(prediciton_cla_xgboost_irna_regulators5$p1*40) + mean_ycount_on_training), 1)

(mse <- mean((as.vector(as.numeric(prediciton_cla_xgboost_irna_regulators6$Yor))-as.vector(prediciton_cla_xgboost_irna_regulators6$pred))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_xgboost_irna_regulators6$Yor)), as.vector(prediciton_cla_xgboost_irna_regulators6$pred)))))
```
#cla_rf_irna_regulators40
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_irna_regulators),5)

#preperation
data <- Model_matrix_irna_regulators
pred_cla_rf_irna_regulators <- data.frame()   
aba_cla_rf_irna_regulators <- data.frame()
prediciton <-data.frame()
importance_cla_rf_irna_regulators<-data.frame()

#5-fold
  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
    #Store corresponding count(authenticated)
    aba_cla_rf_irna_regulators <- rbind(aba_cla_rf_irna_regulators,subset(as.data.frame(test),select =Yor))
    
    #model
    M_cla_rf_irna_regulators <- h2o.randomForest(
                   x = predictors_irna_regulators,
                   y = "Y",
                   training_frame= as.h2o(train),
                   ntrees = 20,
                   max_depth = 10,
                    seed = 1234,
                   min_rows = 1
 )

    #prediction--generate p1
    prediction <- h2o.predict(object = M_cla_rf_irna_regulators, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_cla_rf_irna_regulators <- rbind(pred_cla_rf_irna_regulators,temp)  
    #feature importance
    if(i==1){
      importance_cla_rf_irna_regulators <- h2o.varimp(M_cla_rf_irna_regulators)[c("variable","percentage")]
      names(importance_cla_rf_irna_regulators)[names(importance_cla_rf_irna_regulators) == "percentage"] <- "percentage1"
            }else{
      importance_cla_rf_irna_regulators <- merge(x=importance_cla_rf_irna_regulators,y=h2o.varimp(M_cla_rf_irna_regulators)[c("variable","percentage")],by="variable")
      names(importance_cla_rf_irna_regulators)[names(importance_cla_rf_irna_regulators) == "percentage"] <- paste0("percentage",i)
                  }
    #save model
    setwd("~/Model")
    saveRDS(M_cla_rf_irna_regulators,paste0("M_cla_rf_irna_regulators_",i,".rds"))
  }

#for table1--auc mcc
library(ROCR)
pred <- prediction(as.numeric(pred_cla_rf_irna_regulators$p1), as.numeric(pred_cla_rf_irna_regulators$Y))
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)

#for table3
print("-------------------------------table3")
prediciton_cla_rf_irna_regulators3<-data.frame()
prediciton_cla_rf_irna_regulators3<- cbind(as.data.frame(pred_cla_rf_irna_regulators$p1),as.data.frame(aba_cla_rf_irna_regulators$Yor))
names(prediciton_cla_rf_irna_regulators3)[names(prediciton_cla_rf_irna_regulators3) == 'aba_cla_rf_irna_regulators$Yor'] <- 'Yor'
names(prediciton_cla_rf_irna_regulators3)[names(prediciton_cla_rf_irna_regulators3) == 'pred_cla_rf_irna_regulators$p1'] <- 'p1'

(mse <- mean((as.vector(as.numeric(prediciton_cla_rf_irna_regulators3$Yor))-as.vector(40*prediciton_cla_rf_irna_regulators3$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_rf_irna_regulators3$Yor)), as.vector(40*prediciton_cla_rf_irna_regulators3$p1)))))

#plot
importance_cla_rf_irna_regulators$mean <- apply(importance_cla_rf_irna_regulators[,2:6], 1, mean)
importance_cla_rf_irna_regulators$sd <- apply(importance_cla_rf_irna_regulators[,2:6], 1, sd)
library(ggplot2)
P_importance_cla_rf_irna_regulators <-importance_cla_rf_irna_regulators[c("variable","mean","sd")] 
P_importance_cla_rf_irna_regulators<- P_importance_cla_rf_irna_regulators[order(P_importance_cla_rf_irna_regulators$mean,decreasing=TRUE),][1:20,]

plot_cla_rf_irna_regulators <- ggplot(P_importance_cla_rf_irna_regulators[order(P_importance_cla_rf_irna_regulators$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="RF  Model for Classification (iRNA & Regulator)", x="Feature (iRNA & Regulator)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```

```{r}
#table5
w<- which(prediciton_cla_rf_irna_regulators3$Yor==0)
prediciton_cla_rf_irna_regulators5<- prediciton_cla_rf_irna_regulators3[-w,]

(mse <- mean((as.vector(as.numeric(prediciton_cla_rf_irna_regulators5$Yor))-as.vector(40*prediciton_cla_rf_irna_regulators5$p1))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_rf_irna_regulators5$Yor)), as.vector(40*prediciton_cla_rf_irna_regulators5$p1)))))

```

```{r}
#table6
prediciton_cla_rf_irna_regulators6 <- prediciton_cla_rf_irna_regulators5
prediciton_cla_rf_irna_regulators6$pred <- pmax( round( (prediciton_cla_rf_irna_regulators6$p1*40) - mean(prediciton_cla_rf_irna_regulators5$p1*40) + mean_ycount_on_training), 1)

(mse <- mean((as.vector(as.numeric(prediciton_cla_rf_irna_regulators6$Yor))-as.vector(prediciton_cla_rf_irna_regulators6$pred))^2))
(ce <-  -1*mean(log(dpois(as.vector(as.numeric(prediciton_cla_rf_irna_regulators6$Yor)), as.vector(prediciton_cla_rf_irna_regulators6$pred)))))
```

#reg_glm_irna_regulators41
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_or_matrix_irna_regulators),5)

data <- Model_or_matrix_irna_regulators
pred_reg_glm_irna_regulators <- data.frame()   
importance_reg_glm_irna_regulators<-data.frame()

  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
      M_reg_glm_irna_regulators <- h2o.glm(x = predictors_irna_regulators, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  family ="poisson",
                                                  seed = 1234)
                                     
    
    prediction <- h2o.predict(object = M_reg_glm_irna_regulators, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_glm_irna_regulators <- rbind(pred_reg_glm_irna_regulators,temp) 
    
     #feature importance
    
    if(i==1){
      importance_reg_glm_irna_regulators <- h2o.varimp(M_reg_glm_irna_regulators)[c("variable","percentage")]
      names(importance_reg_glm_irna_regulators)[names(importance_reg_glm_irna_regulators) == "percentage"] <- "percentage1"
            }else{
      importance_reg_glm_irna_regulators <- merge(x=importance_reg_glm_irna_regulators,y=h2o.varimp(M_reg_glm_irna_regulators)[c("variable","percentage")],by="variable")
      names(importance_reg_glm_irna_regulators)[names(importance_reg_glm_irna_regulators) == "percentage"] <- paste0("percentage",i)
            }
    
    #save model
    setwd("~/Model")
    saveRDS(M_reg_glm_irna_regulators,paste0("M_reg_glm_irna_regulators_",i,".rds"))
  }

    (mse <- mean((as.vector(pred_reg_glm_irna_regulators$Y)-as.vector(pred_reg_glm_irna_regulators$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_glm_irna_regulators$Y), as.vector(pred_reg_glm_irna_regulators$predict)))))
#plot
importance_reg_glm_irna_regulators$mean <- apply(importance_reg_glm_irna_regulators[,2:6], 1, mean)
importance_reg_glm_irna_regulators$sd <- apply(importance_reg_glm_irna_regulators[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_glm_irna_regulators <-importance_reg_glm_irna_regulators[c("variable","mean","sd")] 
P_importance_reg_glm_irna_regulators<- P_importance_reg_glm_irna_regulators[order(P_importance_reg_glm_irna_regulators$mean,decreasing=TRUE),][1:20,]

plot_reg_glm_irna_regulators <- ggplot(P_importance_reg_glm_irna_regulators[order(P_importance_reg_glm_irna_regulators$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="GLM  Model for Poisson Regression (iRNA & Regulator)", x="Feature (iRNA & Regulator)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```

```{r}
#test
kpred_reg_glm_irna_regulators <-pred_reg_glm_irna_regulators
kpred_reg_glm_irna_regulators$predict<- kpred_reg_glm_irna_regulators$predict/max(kpred_reg_glm_irna_regulators$predict)
kpred_reg_glm_irna_regulators$Y[which(kpred_reg_glm_irna_regulators$Y>0)] <- 1

library(ROCR)
pred <- prediction(kpred_reg_glm_irna_regulators$predict, kpred_reg_glm_irna_regulators$Y)
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)
```

#reg_dl_irna_regulators42
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_or_matrix_irna_regulators),5)

data <- Model_or_matrix_irna_regulators
pred_reg_dl_irna_regulators <- data.frame()   
importance_reg_dl_irna_regulators<-data.frame()

  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
      M_reg_dl_irna_regulators <- h2o.deeplearning(x = predictors_irna_regulators, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  distribution = "poisson",
                                                  hidden = c(1),
                                                  seed = 1234)
                                     
    
    prediction <- h2o.predict(object = M_reg_dl_irna_regulators, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_dl_irna_regulators <- rbind(pred_reg_dl_irna_regulators,temp)
    
    #feature importance
    if(i==1){
      importance_reg_dl_irna_regulators <- h2o.varimp(M_reg_dl_irna_regulators)[c("variable","percentage")]
      names(importance_reg_dl_irna_regulators)[names(importance_reg_dl_irna_regulators) == "percentage"] <- "percentage1"
            }else{
      importance_reg_dl_irna_regulators <- merge(x=importance_reg_dl_irna_regulators,y=h2o.varimp(M_reg_dl_irna_regulators)[c("variable","percentage")],by="variable")
      names(importance_reg_dl_irna_regulators)[names(importance_reg_dl_irna_regulators) == "percentage"] <- paste0("percentage",i)
            }
    #save model
    setwd("~/Model")
    saveRDS(M_reg_dl_irna_regulators,paste0("M_reg_dl_irna_regulators_",i,".rds"))
  }

    (mse <- mean((as.vector(pred_reg_dl_irna_regulators$Y)-as.vector(pred_reg_dl_irna_regulators$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_dl_irna_regulators$Y), as.vector(pred_reg_dl_irna_regulators$predict))))) 

#plot
importance_reg_dl_irna_regulators$mean <- apply(importance_reg_dl_irna_regulators[,2:6], 1, mean)
importance_reg_dl_irna_regulators$sd <- apply(importance_reg_dl_irna_regulators[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_dl_irna_regulators <-importance_reg_dl_irna_regulators[c("variable","mean","sd")] 
P_importance_reg_dl_irna_regulators<- P_importance_reg_dl_irna_regulators[order(P_importance_reg_dl_irna_regulators$mean,decreasing=TRUE),][1:20,]

plot_reg_dl_irna_regulators <- ggplot(P_importance_reg_dl_irna_regulators[order(P_importance_reg_dl_irna_regulators$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="MLP  Model for Poisson Regression (iRNA & Regulator)", x="Feature (iRNA & Regulator)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```

```{r}
#test
kpred_reg_dl_irna_regulators  <-pred_reg_dl_irna_regulators 
kpred_reg_dl_irna_regulators $predict<- kpred_reg_dl_irna_regulators $predict/max(kpred_reg_dl_irna_regulators $predict)
kpred_reg_dl_irna_regulators $Y[which(kpred_reg_dl_irna_regulators $Y>0)] <- 1

library(ROCR)
pred <- prediction(kpred_reg_dl_irna_regulators $predict, kpred_reg_dl_irna_regulators $Y)
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)
```
#reg_xgboost_irna_regulators43
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_or_matrix_irna_regulators),5)

data <- Model_or_matrix_irna_regulators
pred_reg_xgboost_irna_regulators <- data.frame() 
importance_reg_xgboost_irna_regulators<-data.frame()


  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
      M_reg_xgboost_irna_regulators <- h2o.xgboost(x = predictors_irna_regulators, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  learn_rate = 0.05,
                                                  gamma = 5,
                                                  max_depth = 5,
                                                  reg_alpha = 10,
                                                  reg_lambda = 10,
                                                  colsample_bytree = 0.3,
                                                  booster = "gbtree", 
                                                  normalize_type = "tree",
                                                  distribution = "poisson",
                                                  seed = 1234)
                                     
    
    prediction <- h2o.predict(object = M_reg_xgboost_irna_regulators, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_xgboost_irna_regulators <- rbind(pred_reg_xgboost_irna_regulators,temp) 
    
   #feature importance
    if(i==1){
      importance_reg_xgboost_irna_regulators <- h2o.varimp(M_reg_xgboost_irna_regulators)[c("variable","percentage")]
      names(importance_reg_xgboost_irna_regulators)[names(importance_reg_xgboost_irna_regulators) == "percentage"] <- "percentage1"
            }else{
      importance_reg_xgboost_irna_regulators <- merge(x=importance_reg_xgboost_irna_regulators,y=h2o.varimp(M_reg_xgboost_irna_regulators)[c("variable","percentage")],by="variable")
      names(importance_reg_xgboost_irna_regulators)[names(importance_reg_xgboost_irna_regulators) == "percentage"] <- paste0("percentage",i)
            }
    
    #save model
    setwd("~/Model")
    saveRDS(M_reg_xgboost_irna_regulators,paste0("M_reg_xgboost_irna_regulators_",i,".rds"))
  }

    (mse <- mean((as.vector(pred_reg_xgboost_irna_regulators$Y)-as.vector(pred_reg_xgboost_irna_regulators$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_xgboost_irna_regulators$Y), as.vector(pred_reg_xgboost_irna_regulators$predict)))))  
#plot
importance_reg_xgboost_irna_regulators$mean <- apply(importance_reg_xgboost_irna_regulators[,2:6], 1, mean)
importance_reg_xgboost_irna_regulators$sd <- apply(importance_reg_xgboost_irna_regulators[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_xgboost_irna_regulators <-importance_reg_xgboost_irna_regulators[c("variable","mean","sd")] 
P_importance_reg_xgboost_irna_regulators<- P_importance_reg_xgboost_irna_regulators[order(P_importance_reg_xgboost_irna_regulators$mean,decreasing=TRUE),][1:20,]

plot_reg_xgboost_irna_regulators <- ggplot(P_importance_reg_xgboost_irna_regulators[order(P_importance_reg_xgboost_irna_regulators$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="XGBoost Model for Poisson Regression (iRNA & Regulator)", x="Feature (iRNA & Regulator)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```

```{r}
#test
kpred_reg_xgboost_irna_regulators   <-pred_reg_xgboost_irna_regulators  
kpred_reg_xgboost_irna_regulators$predict<- kpred_reg_xgboost_irna_regulators$predict/max(kpred_reg_xgboost_irna_regulators $predict)
kpred_reg_xgboost_irna_regulators$Y[which(kpred_reg_xgboost_irna_regulators$Y>0)] <- 1

library(ROCR)
pred <- prediction(kpred_reg_xgboost_irna_regulators$predict, kpred_reg_xgboost_irna_regulators$Y)
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)
```


#reg_rf_irna_regulators44
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_or_matrix_irna_regulators),5)

data <- Model_or_matrix_irna_regulators
pred_reg_rf_irna_regulators <- data.frame()   
importance_reg_rf_irna_regulators<-data.frame()

  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
    M_reg_rf_irna_regulators <- h2o.randomForest(
                   x = predictors_irna_regulators,
                   y = "Y",
                   training_frame= as.h2o(train),
                   ntrees = 20,
                   max_depth = 10,
                    seed = 1234,
                   min_rows = 1
    )
                                     
    
    prediction <- h2o.predict(object = M_reg_rf_irna_regulators, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_rf_irna_regulators <- rbind(pred_reg_rf_irna_regulators,temp)
    
    #feature importance
    
    if(i==1){
      importance_reg_rf_irna_regulators <- h2o.varimp(M_reg_rf_irna_regulators)[c("variable","percentage")]
      names(importance_reg_rf_irna_regulators)[names(importance_reg_rf_irna_regulators) == "percentage"] <- "percentage1"
            }else{
      importance_reg_rf_irna_regulators <- merge(x=importance_reg_rf_irna_regulators,y=h2o.varimp(M_reg_rf_irna_regulators)[c("variable","percentage")],by="variable")
      names(importance_reg_rf_irna_regulators)[names(importance_reg_rf_irna_regulators) == "percentage"] <- paste0("percentage",i)
            }
    
    #save model
    setwd("~/Model")
    saveRDS(M_reg_rf_irna_regulators,paste0("M_reg_rf_irna_regulators_",i,".rds"))    
  }

    (mse <- mean((as.vector(pred_reg_rf_irna_regulators$Y)-as.vector(pred_reg_rf_irna_regulators$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_rf_irna_regulators$Y), as.vector(pred_reg_rf_irna_regulators$predict)))))   

#plot
importance_reg_rf_irna_regulators$mean <- apply(importance_reg_rf_irna_regulators[,2:6], 1, mean)
importance_reg_rf_irna_regulators$sd <- apply(importance_reg_rf_irna_regulators[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_rf_irna_regulators <-importance_reg_rf_irna_regulators[c("variable","mean","sd")] 
P_importance_reg_rf_irna_regulators<- P_importance_reg_rf_irna_regulators[order(P_importance_reg_rf_irna_regulators$mean,decreasing=TRUE),][1:20,]

plot_reg_rf_irna_regulators <- ggplot(P_importance_reg_rf_irna_regulators[order(P_importance_reg_rf_irna_regulators$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="RF Model for Poisson Regression (iRNA & Regulator)", x="Feature (iRNA & Regulator)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```
```{r}
#test
kpred_reg_rf_irna_regulators<-pred_reg_rf_irna_regulators  
kpred_reg_rf_irna_regulators$predict<- kpred_reg_rf_irna_regulators$predict/max(kpred_reg_rf_irna_regulators$predict)
kpred_reg_rf_irna_regulators$Y[which(kpred_reg_rf_irna_regulators$Y>0)] <- 1

library(ROCR)
pred <- prediction(kpred_reg_rf_irna_regulators$predict, kpred_reg_rf_irna_regulators$Y)
auc<- ROCR::performance(pred,"auc")
mcc <- ROCR::performance(pred,"mat")
print(auc@y.values[[1]])
max(mcc@y.values[[1]],na.rm =TRUE)
```

#reg_no_glm_irna_regulators45
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_irna_regulators_no0),5)

data <- Model_matrix_irna_regulators_no0
pred_reg_glm_irna_regulators_no0 <- data.frame() 
importance_reg_glm_irna_regulators_no0<-data.frame()


  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
      M_reg_glm_irna_regulators_no0 <- h2o.glm(x = predictors_irna_regulators, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  family ="poisson",
                                                  seed = 1234)
                                     
    
    prediction <- h2o.predict(object = M_reg_glm_irna_regulators_no0, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_glm_irna_regulators_no0 <- rbind(pred_reg_glm_irna_regulators_no0,temp)
    
    #feature importance
    
    if(i==1){
      importance_reg_glm_irna_regulators_no0 <- h2o.varimp(M_reg_glm_irna_regulators_no0)[c("variable","percentage")]
      names(importance_reg_glm_irna_regulators_no0)[names(importance_reg_glm_irna_regulators_no0) == "percentage"] <- "percentage1"
            }else{
      importance_reg_glm_irna_regulators_no0 <- merge(x=importance_reg_glm_irna_regulators_no0,y=h2o.varimp(M_reg_glm_irna_regulators_no0)[c("variable","percentage")],by="variable")
      names(importance_reg_glm_irna_regulators_no0)[names(importance_reg_glm_irna_regulators_no0) == "percentage"] <- paste0("percentage",i)
            }
    
    #save model
    setwd("~/Model")
    saveRDS(M_reg_glm_irna_regulators_no0,paste0("M_reg_glm_irna_regulators_no0_",i,".rds"))
  }

    (mse <- mean((as.vector(pred_reg_glm_irna_regulators_no0$Y)-as.vector(pred_reg_glm_irna_regulators_no0$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_glm_irna_regulators_no0$Y), as.vector(pred_reg_glm_irna_regulators_no0$predict)))))
#plot
importance_reg_glm_irna_regulators_no0$mean <- apply(importance_reg_glm_irna_regulators_no0[,2:6], 1, mean)
importance_reg_glm_irna_regulators_no0$sd <- apply(importance_reg_glm_irna_regulators_no0[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_glm_irna_regulators_no0 <-importance_reg_glm_irna_regulators_no0[c("variable","mean","sd")] 
P_importance_reg_glm_irna_regulators_no0<- P_importance_reg_glm_irna_regulators_no0[order(P_importance_reg_glm_irna_regulators_no0$mean,decreasing=TRUE),][1:20,]

plot_reg_glm_irna_regulators_no0 <- ggplot(P_importance_reg_glm_irna_regulators_no0[order(P_importance_reg_glm_irna_regulators_no0$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="GLM  Model for Poisson Regression (without 0)", x="Feature (iRNA & Regulator)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```
#reg_no_dl_irna_regulators46
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_irna_regulators_no0),5)

data <- Model_matrix_irna_regulators_no0
pred_reg_dl_irna_regulators_no0 <- data.frame()
importance_reg_dl_irna_regulators_no0<-data.frame()


  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
      M_reg_dl_irna_regulators_no0 <- h2o.deeplearning(x = predictors_irna_regulators, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  hidden = c(1),
                                                  distribution = "poisson",  
                                                 # adaptive_rate=F,                ## manually tuned learning rate
                                                 # rate=0.01, 
                                                  rate_annealing=2e-6,
                                                  seed = 1234)
                                     
    
    prediction <- h2o.predict(object = M_reg_dl_irna_regulators_no0, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_dl_irna_regulators_no0 <- rbind(pred_reg_dl_irna_regulators_no0,temp) 
    #feature importance
    
    if(i==1){
      importance_reg_dl_irna_regulators_no0 <- h2o.varimp(M_reg_dl_irna_regulators_no0)[c("variable","percentage")]
      names(importance_reg_dl_irna_regulators_no0)[names(importance_reg_dl_irna_regulators_no0) == "percentage"] <- "percentage1"
            }else{
      importance_reg_dl_irna_regulators_no0 <- merge(x=importance_reg_dl_irna_regulators_no0,y=h2o.varimp(M_reg_dl_irna_regulators_no0)[c("variable","percentage")],by="variable")
      names(importance_reg_dl_irna_regulators_no0)[names(importance_reg_dl_irna_regulators_no0) == "percentage"] <- paste0("percentage",i)
            }
    
    #save model
    setwd("~/Model")
    saveRDS(M_reg_dl_irna_regulators_no0,paste0("M_reg_dl_irna_regulators_no0_",i,".rds"))
  }
    (mse <- mean((as.vector(pred_reg_dl_irna_regulators_no0$Y)-as.vector(pred_reg_dl_irna_regulators_no0$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_dl_irna_regulators_no0$Y), as.vector(pred_reg_dl_irna_regulators_no0$predict)))))
#plot
importance_reg_dl_irna_regulators_no0$mean <- apply(importance_reg_dl_irna_regulators_no0[,2:6], 1, mean)
importance_reg_dl_irna_regulators_no0$sd <- apply(importance_reg_dl_irna_regulators_no0[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_dl_irna_regulators_no0 <-importance_reg_dl_irna_regulators_no0[c("variable","mean","sd")] 
P_importance_reg_dl_irna_regulators_no0<- P_importance_reg_dl_irna_regulators_no0[order(P_importance_reg_dl_irna_regulators_no0$mean,decreasing=TRUE),][1:20,]

plot_reg_dl_irna_regulators_no0 <- ggplot(P_importance_reg_dl_irna_regulators_no0[order(P_importance_reg_dl_irna_regulators_no0$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="MLP  Model for Poisson Regression (without 0)", x="Feature (iRNA & Regulator)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))

```

#reg_no_xgboost_irna_regulators47
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_irna_regulators_no0),5)

data <- Model_matrix_irna_regulators_no0
pred_reg_xgboost_irna_regulators_no0 <- data.frame() 
importance_reg_xgboost_irna_regulators_no0<-data.frame()


  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
      M_reg_xgboost_irna_regulators_no0 <- h2o.xgboost(x = predictors_irna_regulators, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  learn_rate = 0.05,
                                                  gamma = 5,
                                                  max_depth = 5,
                                                  reg_alpha = 10,
                                                  reg_lambda = 10,
                                                  colsample_bytree = 0.3,
                                                  booster = "gbtree", 
                                                  normalize_type = "tree",
                                                  distribution = "poisson",
                                                  seed = 1234)
                                     
    
    prediction <- h2o.predict(object = M_reg_xgboost_irna_regulators_no0, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_xgboost_irna_regulators_no0 <- rbind(pred_reg_xgboost_irna_regulators_no0,temp)
    #feature importance
    
    if(i==1){
      importance_reg_xgboost_irna_regulators_no0 <- h2o.varimp(M_reg_xgboost_irna_regulators_no0)[c("variable","percentage")]
      names(importance_reg_xgboost_irna_regulators_no0)[names(importance_reg_xgboost_irna_regulators_no0) == "percentage"] <- "percentage1"
            }else{
      importance_reg_xgboost_irna_regulators_no0 <- merge(x=importance_reg_xgboost_irna_regulators_no0,y=h2o.varimp(M_reg_xgboost_irna_regulators_no0)[c("variable","percentage")],by="variable")
      names(importance_reg_xgboost_irna_regulators_no0)[names(importance_reg_xgboost_irna_regulators_no0) == "percentage"] <- paste0("percentage",i)
            }
    #save model
    setwd("~/Model")
    saveRDS(M_reg_xgboost_irna_regulators_no0,paste0("M_reg_xgboost_irna_regulators_no0_",i,".rds"))
  }

    (mse <- mean((as.vector(pred_reg_xgboost_irna_regulators_no0$Y)-as.vector(pred_reg_xgboost_irna_regulators_no0$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_xgboost_irna_regulators_no0$Y), as.vector(pred_reg_xgboost_irna_regulators_no0$predict)))))
#plot
importance_reg_xgboost_irna_regulators_no0$mean <- apply(importance_reg_xgboost_irna_regulators_no0[,2:6], 1, mean)
importance_reg_xgboost_irna_regulators_no0$sd <- apply(importance_reg_xgboost_irna_regulators_no0[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_xgboost_irna_regulators_no0 <-importance_reg_xgboost_irna_regulators_no0[c("variable","mean","sd")] 
P_importance_reg_xgboost_irna_regulators_no0<- P_importance_reg_xgboost_irna_regulators_no0[order(P_importance_reg_xgboost_irna_regulators_no0$mean,decreasing=TRUE),][1:20,]

plot_reg_xgboost_irna_regulators_no0 <- ggplot(P_importance_reg_xgboost_irna_regulators_no0[order(P_importance_reg_xgboost_irna_regulators_no0$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="XGBoost Model for Poisson Regression (without 0)", x="Feature (iRNA & Regulator)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```


#reg_no_rf_irna_regulators48
```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_irna_regulators_no0),5)

data <- Model_matrix_irna_regulators_no0
pred_reg_rf_irna_regulators_no0 <- data.frame()   
importance_reg_rf_irna_regulators_no0<-data.frame()

  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
    M_reg_rf_irna_regulators_no0 <- h2o.randomForest(
                   x = predictors_irna_regulators,
                   y = "Y",
                   training_frame= as.h2o(train),
                   ntrees = 20,
                   max_depth = 10,
                    seed = 1234,
                   min_rows = 1
    )
                                     
    
    prediction <- h2o.predict(object = M_reg_rf_irna_regulators_no0, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_rf_irna_regulators_no0 <- rbind(pred_reg_rf_irna_regulators_no0,temp)
    
    #feature importance
    
    if(i==1){
      importance_reg_rf_irna_regulators_no0 <- h2o.varimp(M_reg_rf_irna_regulators_no0)[c("variable","percentage")]
      names(importance_reg_rf_irna_regulators_no0)[names(importance_reg_rf_irna_regulators_no0) == "percentage"] <- "percentage1"
            }else{
      importance_reg_rf_irna_regulators_no0 <- merge(x=importance_reg_rf_irna_regulators_no0,y=h2o.varimp(M_reg_rf_irna_regulators_no0)[c("variable","percentage")],by="variable")
      names(importance_reg_rf_irna_regulators_no0)[names(importance_reg_rf_irna_regulators_no0) == "percentage"] <- paste0("percentage",i)
            }
    
    #save model
    setwd("~/Model")
    saveRDS(M_reg_rf_irna_regulators_no0,paste0("M_reg_rf_irna_no0_",i,".rds"))    
  }

    (mse <- mean((as.vector(pred_reg_rf_irna_regulators_no0$Y)-as.vector(pred_reg_rf_irna_regulators_no0$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_rf_irna_regulators_no0$Y), as.vector(pred_reg_rf_irna_regulators_no0$predict)))))   

#plot
importance_reg_rf_irna_regulators_no0$mean <- apply(importance_reg_rf_irna_regulators_no0[,2:6], 1, mean)
importance_reg_rf_irna_regulators_no0$sd <- apply(importance_reg_rf_irna_regulators_no0[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_rf_irna_regulators_no0 <-importance_reg_rf_irna_regulators_no0[c("variable","mean","sd")] 
P_importance_reg_rf_irna_regulators_no0<- P_importance_reg_rf_irna_regulators_no0[order(P_importance_reg_rf_irna_regulators_no0$mean,decreasing=TRUE),][1:20,]

plot_reg_rf_irna_regulators_no0 <- ggplot(P_importance_reg_rf_irna_regulators_no0[order(P_importance_reg_rf_irna_regulators_no0$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="RF Model for Poisson Regression (without 0)", x="Feature (iRNA & Regulator)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))
```
#
```{r}
 (a <- h2o.r2(M_reg_glm_irna))
 (b <- h2o.r2(M_reg_dl_irna))
   (d <- h2o.r2(M_reg_rf_irna))
  (c <- h2o.r2(M_reg_xgboost_irna))
print("---------------------")
    (q <- h2o.r2(M_reg_glm_irna_whistle))
     (w <- h2o.r2(M_reg_dl_irna_whistle))
       (t <- h2o.r2(M_reg_rf_irna_whistle))
      (r <- h2o.r2(M_reg_xgboost_irna_whistle))
print("---------------------")
    (f <- h2o.r2(M_reg_glm_all))
     (g <- h2o.r2(M_reg_dl_all))
       (i <- h2o.r2(M_reg_rf_all))
      (h <- h2o.r2(M_reg_xgboost_all))

(j <- h2o.performance(M_reg_glm_irna))

#pred_reg_xgboost_all/max(pred_reg_xgboost_all)
```


```{r}
library(plyr)
cvlist<- caret::createFolds(1:nrow(Model_matrix_all_no0),5)

data <- Model_matrix_all_no0
pred_reg_glm_all_no0 <- data.frame()
importance_reg_glm_all_no0<-data.frame()


  for (i in 1:5){
    train <- data[-cvlist[[i]],]  
    test <- data[cvlist[[i]],]
      M_reg_glm_all_no0 <- h2o.glm(x = predictors_all, y = "Y", 
                                                  training_frame = as.h2o(train),
                                                  family ="poisson",
                                                  seed = 1234)
                                     
    
    prediction <- h2o.predict(object = M_reg_glm_all_no0, newdata =as.h2o(test))  
    temp <- cbind(subset(as.data.frame(test),select =Y),as.data.frame(prediction))
    pred_reg_glm_all_no0 <- rbind(pred_reg_glm_all_no0,temp)
    
    #feature importance
    
    if(i==1){
      importance_reg_glm_all_no0 <- h2o.varimp(M_reg_glm_all_no0)[c("variable","percentage")]
      names(importance_reg_glm_all_no0)[names(importance_reg_glm_all_no0) == "percentage"] <- "percentage1"
            }else{
      importance_reg_glm_all_no0 <- merge(x=importance_reg_glm_all_no0,y=h2o.varimp(M_reg_glm_all_no0)[c("variable","percentage")],by="variable")
      names(importance_reg_glm_all_no0)[names(importance_reg_glm_all_no0) == "percentage"] <- paste0("percentage",i)
            }
    
    #save model
    setwd("~/Model")
    saveRDS(M_reg_glm_all_no0,paste0("M_reg_glm_all_no0_",i,".rds"))
  }

    (mse <- mean((as.vector(pred_reg_glm_all_no0$Y)-as.vector(pred_reg_glm_all_no0$predict))^2))
    (ce <-  -1*mean(log(dpois(as.vector(pred_reg_glm_all_no0$Y), as.vector(pred_reg_glm_all_no0$predict)))))
#plot
importance_reg_glm_all_no0$mean <- apply(importance_reg_glm_all_no0[,2:6], 1, mean)
importance_reg_glm_all_no0$sd <- apply(importance_reg_glm_all_no0[,2:6], 1, sd)
library(ggplot2)
P_importance_reg_glm_all_no0 <-importance_reg_glm_all_no0[c("variable","mean","sd")] 
P_importance_reg_glm_all_no0<- P_importance_reg_glm_all_no0[order(P_importance_reg_glm_all_no0$mean,decreasing=TRUE),][1:20,]

plot_reg_glm_all_no0 <- ggplot(P_importance_reg_glm_all_no0[order(P_importance_reg_glm_all_no0$mean,decreasing=TRUE),][1:20,],
                             aes(x=reorder(variable,-mean), y=mean))+
     labs(title="Model_reg_glm_all_no0", x="Feature(irna_whistle_reglator)", y="Percentage of feature imprtance (5-fold)")+
     geom_bar(stat = "identity", position=position_dodge(), 
              width=0.7, color="grey", fill= brewer.pal(7, "Pastel2")[1],) + 
     geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=0.2,color="black",position=position_dodge(0.6))+
     theme(axis.text.x = element_text(angle =60,vjust = 1, hjust=1),plot.title = element_text(hjust = 0.5))

```





```{r}
h2o.shutdown()
plot_cla_rf_irna_whistle
plot_reg_rf_irna_whistle
plot_reg_rf_irna_whistle_no0
plot_cla_rf_all
plot_reg_rf_all
plot_reg_rf_all_no0

plot_cla_xgboost_irna_whistle
plot_reg_xgboost_irna_whistle
plot_reg_xgboost_irna_whistle_no0
plot_cla_xgboost_all
plot_reg_xgboost_all
plot_reg_xgboost_all_no0

```